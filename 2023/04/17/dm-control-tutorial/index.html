<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="dm_control æ•™ç¨‹" />
    <meta name="hexo-theme-A4" content="v1.8.9" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>å°‘å¸¥çš„åšå®¢</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.1.1"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="å°‘å¸¥çš„åšå®¢" type="application/atom+xml">
</head>
    
    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">å°‘å¸¥çš„åšå®¢</a> 
            <span class="description">Shaw Shai&#39;s Blog</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">ğŸŒ„é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ“–æ–‡ç« </a></li>
            
        
            
                <li><a href="/about/">â›„å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            dm_control æ•™ç¨‹
        </div>
      
    

    <div class="post-md">
        
        <div class=".article-gallery"><div align="center">æœ¬æ–‡ä¸º dm_control æ•™ç¨‹çš„ç®€å•ç¿»è¯‘. </div>

<span id="more"></span>
<p>åŸæ•™ç¨‹é“¾æ¥:</p>
<p><a target="_blank" rel="noopener" href="https://colab.research.google.com/github/deepmind/dm_control/blob/main/tutorial.ipynb">https://colab.research.google.com/github/deepmind/dm_control/blob/main/tutorial.ipynb</a></p>
<p>GitHubé“¾æ¥: <a target="_blank" rel="noopener" href="https://github.com/deepmind/dm_control">deepmind/dm_control</a> </p>
<p><a target="_blank" rel="noopener" href="http://arxiv.org/abs/2006.12983">ç›¸å…³æ–‡çŒ®</a> </p>
<h2 id="åœ¨-Colab-ä¸­å®‰è£…-dm-control"><a href="#åœ¨-Colab-ä¸­å®‰è£…-dm-control" class="headerlink" title="åœ¨ Colab ä¸­å®‰è£… dm_control"></a><strong>åœ¨ Colab ä¸­å®‰è£… <code>dm_control</code></strong></h2><h3 id="è¿è¡Œå‘½ä»¤å®‰è£…MuJoCoå’Œ-dm-control"><a href="#è¿è¡Œå‘½ä»¤å®‰è£…MuJoCoå’Œ-dm-control" class="headerlink" title="è¿è¡Œå‘½ä»¤å®‰è£…MuJoCoå’Œ dm_control"></a><strong>è¿è¡Œå‘½ä»¤å®‰è£…MuJoCoå’Œ <code>dm_control</code></strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Run to install MuJoCo and `dm_control`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> distutils.util</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">if</span> subprocess.run(<span class="string">'nvidia-smi'</span>).returncode:</span><br><span class="line">  <span class="keyword">raise</span> RuntimeError(</span><br><span class="line">      <span class="string">'Cannot communicate with GPU. '</span></span><br><span class="line">      <span class="string">'Make sure you are using a GPU Colab runtime. '</span></span><br><span class="line">      <span class="string">'Go to the Runtime menu and select Choose runtime type.'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Installing dm_control...'</span>)</span><br><span class="line">!pip install -q dm_control&gt;=<span class="number">1.0</span><span class="number">.11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure dm_control to use the EGL rendering backend (requires GPU)</span></span><br><span class="line">%env MUJOCO_GL=egl</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Checking that the dm_control installation succeeded...'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  <span class="keyword">from</span> dm_control <span class="keyword">import</span> suite</span><br><span class="line">  env = suite.load(<span class="string">'cartpole'</span>, <span class="string">'swingup'</span>)</span><br><span class="line">  pixels = env.physics.render()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">  <span class="keyword">raise</span> e <span class="keyword">from</span> RuntimeError(</span><br><span class="line">      <span class="string">'Something went wrong during installation. Check the shell output above '</span></span><br><span class="line">      <span class="string">'for more information.\n'</span></span><br><span class="line">      <span class="string">'If using a hosted Colab runtime, make sure you enable GPU acceleration '</span></span><br><span class="line">      <span class="string">'by going to the Runtime menu and selecting "Choose runtime type".'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="keyword">del</span> pixels, suite</span><br><span class="line"></span><br><span class="line">!echo Installed dm_control $(pip show dm_control | grep -Po <span class="string">"(?&lt;=Version: ).+"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="å¯¼å…¥åŒ…"><a href="#å¯¼å…¥åŒ…" class="headerlink" title="å¯¼å…¥åŒ…"></a><strong>å¯¼å…¥åŒ…</strong></h2><h3 id="æœ¬æ•™ç¨‹æ‰€éœ€çš„æ‰€æœ‰-dm-control-å¯¼å…¥åŒ…"><a href="#æœ¬æ•™ç¨‹æ‰€éœ€çš„æ‰€æœ‰-dm-control-å¯¼å…¥åŒ…" class="headerlink" title="æœ¬æ•™ç¨‹æ‰€éœ€çš„æ‰€æœ‰ dm_control å¯¼å…¥åŒ…"></a><strong>æœ¬æ•™ç¨‹æ‰€éœ€çš„æ‰€æœ‰ <code>dm_control</code> å¯¼å…¥åŒ…</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title All `dm_control` imports required for this tutorial</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The basic mujoco wrapper.</span></span><br><span class="line"><span class="keyword">from</span> dm_control <span class="keyword">import</span> mujoco</span><br><span class="line"></span><br><span class="line"><span class="comment"># Access to enums and MuJoCo library functions.</span></span><br><span class="line"><span class="keyword">from</span> dm_control.mujoco.wrapper.mjbindings <span class="keyword">import</span> enums</span><br><span class="line"><span class="keyword">from</span> dm_control.mujoco.wrapper.mjbindings <span class="keyword">import</span> mjlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># PyMJCF</span></span><br><span class="line"><span class="keyword">from</span> dm_control <span class="keyword">import</span> mjcf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Composer high level imports</span></span><br><span class="line"><span class="keyword">from</span> dm_control <span class="keyword">import</span> composer</span><br><span class="line"><span class="keyword">from</span> dm_control.composer.observation <span class="keyword">import</span> observable</span><br><span class="line"><span class="keyword">from</span> dm_control.composer <span class="keyword">import</span> variation</span><br><span class="line"></span><br><span class="line"><span class="comment"># Imports for Composer tutorial example</span></span><br><span class="line"><span class="keyword">from</span> dm_control.composer.variation <span class="keyword">import</span> distributions</span><br><span class="line"><span class="keyword">from</span> dm_control.composer.variation <span class="keyword">import</span> noises</span><br><span class="line"><span class="keyword">from</span> dm_control.locomotion.arenas <span class="keyword">import</span> floors</span><br><span class="line"></span><br><span class="line"><span class="comment"># Control Suite</span></span><br><span class="line"><span class="keyword">from</span> dm_control <span class="keyword">import</span> suite</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run through corridor example</span></span><br><span class="line"><span class="keyword">from</span> dm_control.locomotion.walkers <span class="keyword">import</span> cmu_humanoid</span><br><span class="line"><span class="keyword">from</span> dm_control.locomotion.arenas <span class="keyword">import</span> corridors <span class="keyword">as</span> corridor_arenas</span><br><span class="line"><span class="keyword">from</span> dm_control.locomotion.tasks <span class="keyword">import</span> corridors <span class="keyword">as</span> corridor_tasks</span><br><span class="line"></span><br><span class="line"><span class="comment"># Soccer</span></span><br><span class="line"><span class="keyword">from</span> dm_control.locomotion <span class="keyword">import</span> soccer</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manipulation</span></span><br><span class="line"><span class="keyword">from</span> dm_control <span class="keyword">import</span> manipulation</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å…¶ä»–å¯¼å…¥åŒ…å’Œå¸®åŠ©å‡½æ•°"><a href="#å…¶ä»–å¯¼å…¥åŒ…å’Œå¸®åŠ©å‡½æ•°" class="headerlink" title="å…¶ä»–å¯¼å…¥åŒ…å’Œå¸®åŠ©å‡½æ•°"></a><strong>å…¶ä»–å¯¼å…¥åŒ…å’Œå¸®åŠ©å‡½æ•°</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Other imports and helper functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># General</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> clear_output</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Graphics-related</span></span><br><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line"><span class="keyword">import</span> matplotlib.animation <span class="keyword">as</span> animation</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> HTML</span><br><span class="line"><span class="keyword">import</span> PIL.Image</span><br><span class="line"><span class="comment"># Internal loading of video libraries.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use svg backend for figure rendering</span></span><br><span class="line">%config InlineBackend.figure_format = <span class="string">'svg'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Font sizes</span></span><br><span class="line">SMALL_SIZE = <span class="number">8</span></span><br><span class="line">MEDIUM_SIZE = <span class="number">10</span></span><br><span class="line">BIGGER_SIZE = <span class="number">12</span></span><br><span class="line">plt.rc(<span class="string">'font'</span>, size=SMALL_SIZE)          <span class="comment"># controls default text sizes</span></span><br><span class="line">plt.rc(<span class="string">'axes'</span>, titlesize=SMALL_SIZE)     <span class="comment"># fontsize of the axes title</span></span><br><span class="line">plt.rc(<span class="string">'axes'</span>, labelsize=MEDIUM_SIZE)    <span class="comment"># fontsize of the x and y labels</span></span><br><span class="line">plt.rc(<span class="string">'xtick'</span>, labelsize=SMALL_SIZE)    <span class="comment"># fontsize of the tick labels</span></span><br><span class="line">plt.rc(<span class="string">'ytick'</span>, labelsize=SMALL_SIZE)    <span class="comment"># fontsize of the tick labels</span></span><br><span class="line">plt.rc(<span class="string">'legend'</span>, fontsize=SMALL_SIZE)    <span class="comment"># legend fontsize</span></span><br><span class="line">plt.rc(<span class="string">'figure'</span>, titlesize=BIGGER_SIZE)  <span class="comment"># fontsize of the figure title</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inline video helper function</span></span><br><span class="line"><span class="keyword">if</span> os.environ.get(<span class="string">'COLAB_NOTEBOOK_TEST'</span>, <span class="literal">False</span>):</span><br><span class="line">  <span class="comment"># We skip video generation during tests, as it is quite expensive.</span></span><br><span class="line">  display_video = <span class="keyword">lambda</span> *args, **kwargs: <span class="literal">None</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">display_video</span>(<span class="params">frames, framerate=<span class="number">30</span></span>):</span><br><span class="line">    height, width, _ = frames[<span class="number">0</span>].shape</span><br><span class="line">    dpi = <span class="number">70</span></span><br><span class="line">    orig_backend = matplotlib.get_backend()</span><br><span class="line">    matplotlib.use(<span class="string">'Agg'</span>)  <span class="comment"># Switch to headless 'Agg' to inhibit figure rendering.</span></span><br><span class="line">    fig, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>, figsize=(width / dpi, height / dpi), dpi=dpi)</span><br><span class="line">    matplotlib.use(orig_backend)  <span class="comment"># Switch back to the original backend.</span></span><br><span class="line">    ax.set_axis_off()</span><br><span class="line">    ax.set_aspect(<span class="string">'equal'</span>)</span><br><span class="line">    ax.set_position([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">    im = ax.imshow(frames[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">frame</span>):</span><br><span class="line">      im.set_data(frame)</span><br><span class="line">      <span class="keyword">return</span> [im]</span><br><span class="line">    interval = <span class="number">1000</span>/framerate</span><br><span class="line">    anim = animation.FuncAnimation(fig=fig, func=update, frames=frames,</span><br><span class="line">                                   interval=interval, blit=<span class="literal">True</span>, repeat=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">return</span> HTML(anim.to_html5_video())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Seed numpy's global RNG so that cell outputs are deterministic. We also try to</span></span><br><span class="line"><span class="comment"># use RandomState instances that are local to a single cell wherever possible.</span></span><br><span class="line">np.random.seed(<span class="number">42</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ¨¡å‹å®šä¹‰-ç¼–è¯‘å’Œæ¸²æŸ“"><a href="#æ¨¡å‹å®šä¹‰-ç¼–è¯‘å’Œæ¸²æŸ“" class="headerlink" title="æ¨¡å‹å®šä¹‰, ç¼–è¯‘å’Œæ¸²æŸ“"></a><strong>æ¨¡å‹å®šä¹‰, ç¼–è¯‘å’Œæ¸²æŸ“</strong></h2><p>æˆ‘ä»¬é¦–å…ˆæè¿° <a target="_blank" rel="noopener" href="http://mujoco.org/">MuJoCo</a> ç‰©ç†æ¨¡æ‹Ÿåº“çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ, ä½†æ¨èä½¿ç”¨<a target="_blank" rel="noopener" href="http://mujoco.org/book/">å®˜æ–¹æ–‡æ¡£</a>äº†è§£è¯¦ç»†ä¿¡æ¯.</p>
<h3 id="é™æ€æ¨¡å‹"><a href="#é™æ€æ¨¡å‹" class="headerlink" title="é™æ€æ¨¡å‹"></a><strong>é™æ€æ¨¡å‹</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title A static model {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">static_model = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="top" pos="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">physics = mujoco.Physics.from_xml_string(static_model)</span><br><span class="line">pixels = physics.render()</span><br><span class="line">PIL.Image.fromarray(pixels)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/0.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/0.png" class="" title="model"></a></div>

<p><code>static_model</code> æ˜¯ç”¨ MuJoCo åŸºäº XML çš„ <a target="_blank" rel="noopener" href="http://www.mujoco.org/book/modeling.html">MJCF</a> å»ºæ¨¡è¯­è¨€ç¼–å†™çš„. <code>from_xml_string()</code> æ–¹æ³•è°ƒç”¨æ¨¡å‹ç¼–è¯‘å™¨, è¯¥ç¼–è¯‘å™¨å®ä¾‹åŒ–åº“çš„å†…éƒ¨æ•°æ®ç»“æ„. è¿™äº›å¯ä»¥é€šè¿‡ <code>physics</code> å¯¹è±¡è®¿é—®, è§ä¸‹æ–‡.</p>
<h3 id="æ·»åŠ è‡ªç”±åº¦å’Œä»¿çœŸ-é«˜çº§æ¸²æŸ“"><a href="#æ·»åŠ è‡ªç”±åº¦å’Œä»¿çœŸ-é«˜çº§æ¸²æŸ“" class="headerlink" title="æ·»åŠ è‡ªç”±åº¦å’Œä»¿çœŸ, é«˜çº§æ¸²æŸ“"></a><strong>æ·»åŠ è‡ªç”±åº¦å’Œä»¿çœŸ, é«˜çº§æ¸²æŸ“</strong></h3><p>è¿™æ˜¯ä¸€ä¸ªå®Œå…¨åˆç†çš„æ¨¡å‹, ä½†å¦‚æœæˆ‘ä»¬æ¨¡æ‹Ÿå®ƒ, é™¤äº†æ—¶é—´æ¨è¿›, ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿ. è¿™æ˜¯å› ä¸ºè¿™ä¸ªæ¨¡å‹æ²¡æœ‰è‡ªç”±åº¦(DOFs). æˆ‘ä»¬é€šè¿‡ç»™ç‰©ä½“æ·»åŠ å…³èŠ‚(<strong>joints</strong>)æ¥æ·»åŠ è‡ªç”±åº¦, æŒ‡å®šå®ƒä»¬å¦‚ä½•ç›¸å¯¹äºå®ƒä»¬çš„ parents ç§»åŠ¨. è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé“°é“¾å…³èŠ‚å¹¶é‡æ–°æ¸²æŸ“, å¹¶å¯è§†åŒ–å…³èŠ‚è½´.</p>
<p><strong>å¸¦å…³èŠ‚çš„å­ body</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title A child body with a joint { vertical-output: true }</span></span><br><span class="line"></span><br><span class="line">swinging_body = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="top" pos="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="box_and_sphere" euler="0 0 -30"&gt;  </span></span><br><span class="line"><span class="string">      &lt;joint name="swing" type="hinge" axis="1 -1 0" pos="-.2 -.2 -.2"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">physics = mujoco.Physics.from_xml_string(swinging_body)</span><br><span class="line"><span class="comment"># Visualize the joint axis.</span></span><br><span class="line">scene_option = mujoco.wrapper.core.MjvOption()</span><br><span class="line">scene_option.flags[enums.mjtVisFlag.mjVIS_JOINT] = <span class="literal">True</span></span><br><span class="line">pixels = physics.render(scene_option=scene_option)</span><br><span class="line">PIL.Image.fromarray(pixels)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/1.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/1.png" class="" title="joint"></a></div>

<p>è¿åŠ¨çš„(æœ‰æƒ¯æ€§çš„)ç‰©ä½“å«åš bodies. Body çš„å­ <code>joint</code> æŒ‡å®šäº†è¯¥ body å¦‚ä½•ç›¸å¯¹äºå®ƒçš„ parent ç§»åŠ¨, åœ¨æœ¬ä¾‹ä¸­ <code>box_and_sphere</code> å…³äº<code>worldbody</code>.</p>
<p>æ³¨æ„, body çš„åæ ‡ç³»æ˜¯ç”¨ <code>euler</code> æŒ‡ä»¤æ—‹è½¬(<strong>rotated</strong>)çš„, å®ƒçš„é™„å±å‡ ä½•ä½“å’Œå…³èŠ‚ä¹Ÿéšä¹‹æ—‹è½¬. è¿™æ˜¯ä¸ºäº†å¼ºè°ƒ MJCF ä¸­ä½ç½®å’Œæ–¹å‘æŒ‡ä»¤çš„ local-to-parent-frame çš„æ€§è´¨.</p>
<p>æˆ‘ä»¬æ¥åšä¸ªè§†é¢‘, äº†è§£ä¸€ä¸‹åŠ¨åŠ›å­¦, çœ‹çœ‹ç‰©ä½“åœ¨é‡åŠ›ä½œç”¨ä¸‹çš„æ‘†åŠ¨.</p>
<p><strong>åˆ¶ä½œè§†é¢‘</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Making a video {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">duration = <span class="number">2</span>    <span class="comment"># (seconds)</span></span><br><span class="line">framerate = <span class="number">30</span>  <span class="comment"># (Hz)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Visualize the joint axis</span></span><br><span class="line">scene_option = mujoco.wrapper.core.MjvOption()</span><br><span class="line">scene_option.flags[enums.mjtVisFlag.mjVIS_JOINT] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and display video.</span></span><br><span class="line">frames = []</span><br><span class="line">physics.reset()  <span class="comment"># Reset state and time</span></span><br><span class="line"><span class="keyword">while</span> physics.data.time &lt; duration:</span><br><span class="line">  physics.step()</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; physics.data.time * framerate:</span><br><span class="line">    pixels = physics.render(scene_option=scene_option)</span><br><span class="line">    frames.append(pixels)</span><br><span class="line">display_video(frames, framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="rolling.mp4" type="video/mp4">
</video>

<p>æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•é‡‡æ ·è§†é¢‘å¸§çš„. å› ä¸ºç‰©ç†æ¨¡æ‹Ÿæ—¶é—´æ­¥é•¿é€šå¸¸æ¯”å¸§é€Ÿç‡å°å¾—å¤š(é»˜è®¤æ—¶é—´æ­¥é•¿æ˜¯2æ¯«ç§’), æ‰€ä»¥æˆ‘ä»¬ä¸ä¼šåœ¨æ¯ä¸€æ­¥ä¹‹åéƒ½æ¸²æŸ“.</p>
<h3 id="æ¸²æŸ“é€‰é¡¹"><a href="#æ¸²æŸ“é€‰é¡¹" class="headerlink" title="æ¸²æŸ“é€‰é¡¹"></a><strong>æ¸²æŸ“é€‰é¡¹</strong></h3><p>ä¸å…³èŠ‚å¯è§†åŒ–ä¸€æ ·, é™„åŠ çš„æ¸²æŸ“é€‰é¡¹ä½œä¸ºå‚æ•°å…¬å¼€ç»™ <code>render</code> æ–¹æ³•.</p>
<p><strong>å¯ç”¨é€æ˜åº¦å’Œæ¡†æ¶å¯è§†åŒ–</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Enable transparency and frame visualization {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">scene_option = mujoco.wrapper.core.MjvOption()</span><br><span class="line">scene_option.frame = enums.mjtFrame.mjFRAME_GEOM</span><br><span class="line">scene_option.flags[enums.mjtVisFlag.mjVIS_TRANSPARENT] = <span class="literal">True</span></span><br><span class="line">pixels = physics.render(scene_option=scene_option)</span><br><span class="line">PIL.Image.fromarray(pixels)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/2.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/2.png" class="" title="transparent"></a></div>

<p><strong>æ·±åº¦æ¸²æŸ“</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Depth rendering {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># depth is a float array, in meters.</span></span><br><span class="line">depth = physics.render(depth=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Shift nearest values to the origin.</span></span><br><span class="line">depth -= depth.<span class="built_in">min</span>()</span><br><span class="line"><span class="comment"># Scale by 2 mean distances of near rays.</span></span><br><span class="line">depth /= <span class="number">2</span>*depth[depth &lt;= <span class="number">1</span>].mean()</span><br><span class="line"><span class="comment"># Scale to [0, 255]</span></span><br><span class="line">pixels = <span class="number">255</span>*np.clip(depth, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">PIL.Image.fromarray(pixels.astype(np.uint8))</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/3.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/3.png" class="" title="depth"></a></div>

<p><strong>åˆ†å‰²æ¸²æŸ“</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Segmentation rendering {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">seg = physics.render(segmentation=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Display the contents of the first channel, which contains object</span></span><br><span class="line"><span class="comment"># IDs. The second channel, seg[:, :, 1], contains object types.</span></span><br><span class="line">geom_ids = seg[:, :, <span class="number">0</span>]</span><br><span class="line"><span class="comment"># Infinity is mapped to -1</span></span><br><span class="line">geom_ids = geom_ids.astype(np.float64) + <span class="number">1</span></span><br><span class="line"><span class="comment"># Scale to [0, 1]</span></span><br><span class="line">geom_ids = geom_ids / geom_ids.<span class="built_in">max</span>()</span><br><span class="line">pixels = <span class="number">255</span>*geom_ids</span><br><span class="line">PIL.Image.fromarray(pixels.astype(np.uint8))</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/4.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/4.png" class="" title="segmentation"></a></div>

<p><strong>ä»ä¸–ç•Œåˆ°ç›¸æœºåæ ‡ç³»æŠ•å½±</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Projecting from world to camera coordinates {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the world coordinates of the box corners</span></span><br><span class="line">box_pos = physics.named.data.geom_xpos[<span class="string">'red_box'</span>]</span><br><span class="line">box_mat = physics.named.data.geom_xmat[<span class="string">'red_box'</span>].reshape(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">box_size = physics.named.model.geom_size[<span class="string">'red_box'</span>]</span><br><span class="line">offsets = np.array([-<span class="number">1</span>, <span class="number">1</span>]) * box_size[:, <span class="literal">None</span>]</span><br><span class="line">xyz_local = np.stack(itertools.product(*offsets)).T</span><br><span class="line">xyz_global = box_pos[:, <span class="literal">None</span>] + box_mat @ xyz_local</span><br><span class="line"></span><br><span class="line"><span class="comment"># Camera matrices multiply homogenous [x, y, z, 1] vectors.</span></span><br><span class="line">corners_homogeneous = np.ones((<span class="number">4</span>, xyz_global.shape[<span class="number">1</span>]), dtype=<span class="built_in">float</span>)</span><br><span class="line">corners_homogeneous[:<span class="number">3</span>, :] = xyz_global</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the camera matrix.</span></span><br><span class="line">camera = mujoco.Camera(physics)</span><br><span class="line">camera_matrix = camera.matrix</span><br><span class="line"></span><br><span class="line"><span class="comment"># Project world coordinates into pixel space. See:</span></span><br><span class="line"><span class="comment"># https://en.wikipedia.org/wiki/3D_projection#Mathematical_formula</span></span><br><span class="line">xs, ys, s = camera_matrix @ corners_homogeneous</span><br><span class="line"><span class="comment"># x and y are in the pixel coordinate system.</span></span><br><span class="line">x = xs / s</span><br><span class="line">y = ys / s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Render the camera view and overlay the projected corner coordinates.</span></span><br><span class="line">pixels = camera.render()</span><br><span class="line">fig, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">ax.imshow(pixels)</span><br><span class="line">ax.plot(x, y, <span class="string">'+'</span>, c=<span class="string">'w'</span>)</span><br><span class="line">ax.set_axis_off()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/5.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/5.png" class="" title="projection"></a></div>

<h2 id="MuJoCoåŸºç¡€å’Œå‘½åç´¢å¼•"><a href="#MuJoCoåŸºç¡€å’Œå‘½åç´¢å¼•" class="headerlink" title="MuJoCoåŸºç¡€å’Œå‘½åç´¢å¼•"></a><strong>MuJoCoåŸºç¡€å’Œå‘½åç´¢å¼•</strong></h2><h3 id="mjModel"><a href="#mjModel" class="headerlink" title="mjModel"></a><strong><code>mjModel</code></strong></h3><p>MuJoCo çš„ <code>mjModel</code>, å°è£…åœ¨ <code>physics.model</code>, åŒ…å«æ¨¡å‹æè¿°, åŒ…æ‹¬é»˜è®¤çš„åˆå§‹çŠ¶æ€å’Œå…¶ä»–ä¸æ˜¯çŠ¶æ€å‡½æ•°çš„å›ºå®šé‡, ä¾‹å¦‚å‡ ä½•ä½“åœ¨å…¶çˆ¶åæ ‡ç³»ä¸­çš„ä½ç½®. å‡ ä½•ä½“ <code>box</code> å’Œ <code>sphere</code> ç›¸å¯¹äºå®ƒä»¬çš„çˆ¶ä½“ <code>box_and_sphere</code> çš„ (x, y, z) åç§»é‡ç”± <code>model.geom_pos</code> ç»™å‡º:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">physics.model.geom_pos</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>array([[0. , 0. , 0. ],<br>[0.2, 0.2, 0.2]])</p>
</blockquote>
<p><code>model.opt</code> ç»“æ„åŒ…å«å…¨å±€é‡, å¦‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'timestep'</span>, physics.model.opt.timestep)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'gravity'</span>, physics.model.opt.gravity)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>timestep 0.002<br>gravity [ 0.    0.   -9.81]</p>
</blockquote>
<h3 id="mjData"><a href="#mjData" class="headerlink" title="mjData"></a><strong><code>mjData</code></strong></h3><p><code>mjData</code>, å°è£…åœ¨ <code>physics.data</code>ï¼ŒåŒ…å«ä¾èµ–äºå®ƒçš„çŠ¶æ€å’Œæ•°é‡. çŠ¶æ€ç”±æ—¶é—´, å¹¿ä¹‰ä½ç½®å’Œå¹¿ä¹‰é€Ÿåº¦ç»„æˆ. å®ƒä»¬åˆ†åˆ«ä¸º <code>data.time</code>, <code>data.qpos</code> å’Œ <code>data.qvel</code>.</p>
<p>è®©æˆ‘ä»¬æ‰“å°æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æ‘†ä½“çš„çŠ¶æ€:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(physics.data.time, physics.data.qpos, physics.data.qvel)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>2.0000000000000013 [-0.05319467] [-1.36253678]</p>
</blockquote>
<p><code>physics.data</code> è¿˜åŒ…å«çŠ¶æ€å‡½æ•°, ä¾‹å¦‚ç‰©ä½“åœ¨ä¸–ç•Œåæ ‡ç³»ä¸­çš„ç¬›å¡å°”ä½ç½®. ä¸¤ä¸ªå‡ ä½•ä½“çš„ (x, y, z) ä½ç½®åœ¨ <code>data.geom_xpos</code> ä¸­:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(physics.data.geom_xpos)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>[[ 0.00988513  0.00264871 -0.01532153]<br>[ 0.29297533  0.0785025   0.16935694]]</p>
</blockquote>
<h3 id="å‘½åç´¢å¼•"><a href="#å‘½åç´¢å¼•" class="headerlink" title="å‘½åç´¢å¼•"></a><strong>å‘½åç´¢å¼•</strong></h3><p>ä½¿ç”¨ <code>named</code> å°è£…å™¨ä½¿ä¸Šè¿°æ•°ç»„çš„è¯­ä¹‰æ›´åŠ æ¸…æ™°, å®ƒå°†åç§°åˆ†é…ç»™è¡Œ, å¹¶å°†ç±»å‹åç§°åˆ†é…ç»™åˆ—.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(physics.named.data.geom_xpos)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>FieldIndexer(geom_xpos):<br>x         y         z<br>0      red_box [ 0.00989   0.00265  -0.0153  ]<br>1 green_sphere [ 0.293     0.0785    0.169   ]</p>
</blockquote>
<p>æ³¨æ„ <code>model.geom_pos</code> å’Œ <code>data.geom_xpos</code> å…·æœ‰ç›¸ä¼¼çš„è¯­ä¹‰, ä½†å«ä¹‰éå¸¸ä¸åŒ.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(physics.named.model.geom_pos)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>FieldIndexer(geom_pos):<br>x         y         z<br>0      red_box [ 0         0         0       ]<br>1 green_sphere [ 0.2       0.2       0.2     ]</p>
</blockquote>
<p>åç§°å­—ç¬¦ä¸²å¯ç”¨äºç´¢å¼•åˆ°ç›¸å…³çš„é‡, ä½¿ä»£ç æ›´å…·å¯è¯»æ€§å’Œç¨³å¥æ€§.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">physics.named.data.geom_xpos[<span class="string">'green_sphere'</span>, <span class="string">'z'</span>]</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>0.16935693635325777</p>
</blockquote>
<p>å…³èŠ‚åç§°å¯ä»¥ç”¨äºåœ¨æ„å‹ç©ºé—´ä¸­ç´¢å¼•ç›¸å…³é‡(ä»¥å­—æ¯ <code>q</code> å¼€å¤´):</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">physics.named.data.qpos[<span class="string">'swing'</span>]</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>array([-0.05319467])</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥å°† NumPy åˆ‡ç‰‡æ“ä½œä¸å‘½åç´¢å¼•æ··åˆä½¿ç”¨. ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ box çš„åç§°(<code>"red_box"</code>)ä½œä¸º <code>geom_rgba</code> æ•°ç»„è¡Œç´¢å¼•æ¥è®¾ç½® box çš„é¢œè‰².</p>
<p><strong>é€šè¿‡å‘½åç´¢å¼•æ›´æ”¹é¢œè‰²</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Changing colors using named indexing{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">random_rgb = np.random.rand(<span class="number">3</span>)</span><br><span class="line">physics.named.model.geom_rgba[<span class="string">'red_box'</span>, :<span class="number">3</span>] = random_rgb</span><br><span class="line">pixels = physics.render()</span><br><span class="line">PIL.Image.fromarray(pixels)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/6.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/6.png" class="" title="change-color"></a></div>

<p>æ³¨æ„ <code>physics.model</code> é‡ä¸ä¼šè¢«å¼•æ“æ”¹å˜, æˆ‘ä»¬å¯ä»¥åœ¨æ—¶é—´æ­¥ä¹‹é—´è‡ªè¡Œæ”¹å˜å®ƒä»¬. ç„¶è€Œ, é€šå¸¸ä¸å»ºè®®è¿™æ ·åš, é¦–é€‰çš„æ–¹æ³•æ˜¯ä½¿ç”¨ PyMJCF åº“åœ¨ XML çº§åˆ«ä¿®æ”¹æ¨¡å‹, è§ä¸‹æ–‡.</p>
<h3 id="é€šè¿‡-reset-context-è®¾ç½®çŠ¶æ€"><a href="#é€šè¿‡-reset-context-è®¾ç½®çŠ¶æ€" class="headerlink" title="é€šè¿‡ reset_context() è®¾ç½®çŠ¶æ€"></a><strong>é€šè¿‡ <code>reset_context()</code> è®¾ç½®çŠ¶æ€</strong></h3><p>ä¸ºäº†ä½¿ä½œä¸ºçŠ¶æ€å‡½æ•°çš„ <code>data</code> é‡ä¸çŠ¶æ€åŒæ­¥, éœ€è¦è°ƒç”¨ MuJoCo çš„ <code>mj_step1()</code> . è¿™æ˜¯ç”± <code>reset_context()</code> ä¸Šä¸‹æ–‡ä¿ƒæˆçš„, è¯·å‚é˜…<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2006.12983">æŠ€æœ¯æŠ¥å‘Š</a>2.1èŠ‚çš„æ·±å…¥è®¨è®º.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">physics.named.data.qpos[<span class="string">'swing'</span>] = np.pi</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Without reset_context, spatial positions are not updated:'</span>,</span><br><span class="line">      physics.named.data.geom_xpos[<span class="string">'green_sphere'</span>, [<span class="string">'z'</span>]])</span><br><span class="line"><span class="keyword">with</span> physics.reset_context():</span><br><span class="line">  physics.named.data.qpos[<span class="string">'swing'</span>] = np.pi</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'After reset_context, positions are up-to-date:'</span>,</span><br><span class="line">      physics.named.data.geom_xpos[<span class="string">'green_sphere'</span>, [<span class="string">'z'</span>]])</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Without reset_context, spatial positions are not updated: [0.16935694]<br>After reset_context, positions are up-to-date: [-0.6]</p>
</blockquote>
<h3 id="è‡ªç”±ä½“-è‡ªåè½¬çš„â€œtippe-topâ€"><a href="#è‡ªç”±ä½“-è‡ªåè½¬çš„â€œtippe-topâ€" class="headerlink" title="è‡ªç”±ä½“:è‡ªåè½¬çš„â€œtippe-topâ€"></a><strong>è‡ªç”±ä½“:è‡ªåè½¬çš„â€œtippe-topâ€</strong></h3><p>è‡ªç”±ä½“æ˜¯å…·æœ‰ä¸€ä¸ª <code>free</code> å…³èŠ‚çš„ç‰©ä½“, å…·æœ‰ 6 ä¸ªè¿åŠ¨è‡ªç”±åº¦: 3 ä¸ªå¹³ç§»å’Œ 3 ä¸ªæ—‹è½¬. æˆ‘ä»¬å¯ä»¥ç»™ <code>box_and_sphere</code> ä½“ä¸€ä¸ªè‡ªç”±å…³èŠ‚, ç„¶åçœ‹ç€å®ƒä¸‹è½, ä½†æ˜¯è®©æˆ‘ä»¬çœ‹ä¸€äº›æ›´æœ‰è¶£çš„ä¸œè¥¿. â€œtippe topâ€æ˜¯ä¸€ä¸ªæ—‹è½¬çš„ç©å…·, å®ƒå¯ä»¥ç¿»è½¬è¿‡è‡ªå·±çš„å¤´éƒ¨(<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Tippe_top">ç»´åŸºç™¾ç§‘</a>). æˆ‘ä»¬å°†å…¶å»ºæ¨¡å¦‚ä¸‹:</p>
<p><strong>"Tippe-top" æ¨¡å‹</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title The "tippe-top" model{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">tippe_top = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco model="tippe top"&gt;</span></span><br><span class="line"><span class="string">  &lt;option integrator="RK4"/&gt;</span></span><br><span class="line"><span class="string">  &lt;asset&gt;</span></span><br><span class="line"><span class="string">    &lt;texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3" </span></span><br><span class="line"><span class="string">     rgb2=".2 .3 .4" width="300" height="300"/&gt;</span></span><br><span class="line"><span class="string">    &lt;material name="grid" texture="grid" texrepeat="8 8" reflectance=".2"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/asset&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;geom size=".2 .2 .01" type="plane" material="grid"/&gt;</span></span><br><span class="line"><span class="string">    &lt;light pos="0 0 .6"/&gt;</span></span><br><span class="line"><span class="string">    &lt;camera name="closeup" pos="0 -.1 .07" xyaxes="1 0 0 0 1 2"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="top" pos="0 0 .02"&gt;</span></span><br><span class="line"><span class="string">      &lt;freejoint/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="ball" type="sphere" size=".02" /&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="stem" type="cylinder" pos="0 0 .02" size="0.004 .008"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="ballast" type="box" size=".023 .023 0.005"  pos="0 0 -.015" </span></span><br><span class="line"><span class="string">       contype="0" conaffinity="0" group="3"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">  &lt;keyframe&gt;</span></span><br><span class="line"><span class="string">    &lt;key name="spinning" qpos="0 0 0.02 1 0 0 0" qvel="0 0 0 0 1 200" /&gt;</span></span><br><span class="line"><span class="string">  &lt;/keyframe&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">physics = mujoco.Physics.from_xml_string(tippe_top)</span><br><span class="line">PIL.Image.fromarray(physics.render(camera_id=<span class="string">'closeup'</span>))</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/7.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/7.png" class="" title="tippe-top"></a></div>

<p>æ³¨æ„è¿™ä¸ªæ¨¡å‹å®šä¹‰çš„å‡ ä¸ªæ–°ç‰¹æ€§:</p>
<ol>
<li>è¿™æ˜¯ä½¿ç”¨ <code>&lt;freejoint/&gt;</code> æ ‡ç­¾æ·»åŠ çš„è‡ªç”±å…³èŠ‚, å®ƒç±»ä¼¼äº <code>&lt;joint type="free"/&gt;</code>, ä½†ç¦ç”¨äº†æ‘©æ“¦æˆ–åˆšåº¦ç­‰éç‰©ç†å±æ€§.</li>
<li>æˆ‘ä»¬ä½¿ç”¨ <code>&lt;option/&gt;</code> æ ‡ç­¾å°†ç§¯åˆ†å™¨è®¾ç½®ä¸ºæ›´ç²¾ç¡®çš„ 4 é˜¶ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge Kutta</a>.</li>
<li>æˆ‘ä»¬åœ¨ <code>&lt;asset/&gt;</code> æ ‡ç­¾ä¸­å®šä¹‰åœ°æ¿çš„ç½‘æ ¼æè´¨, å¹¶åœ¨ "floorâ€ å‡ ä½•ä½“ä¸­å¼•ç”¨å®ƒ.</li>
<li>æˆ‘ä»¬ä½¿ç”¨ä¸€ç§ä¸å¯è§çš„, æ— ç¢°æ’çš„ box å‡ ä½•ä½“, ç§°ä¸º <code>ballast</code> , æ¥é™ä½é¡¶éƒ¨çš„è´¨å¿ƒ. ä½è´¨å¿ƒæ˜¯å‘ç”Ÿç¿»è½¬è¡Œä¸ºæ‰€å¿…éœ€çš„(ä¸ç›´è§‰ç›¸å).</li>
<li>æˆ‘ä»¬å°†åˆå§‹æ—‹è½¬çŠ¶æ€ä¿å­˜ä¸ºå…³é”®å¸§. å®ƒç»• Z è½´æœ‰å¾ˆé«˜çš„æ—‹è½¬é€Ÿåº¦, ä½†æœå‘å¹¶ä¸å®Œå…¨é‡åˆäºä¸–ç•Œåæ ‡è½´.</li>
<li>æˆ‘ä»¬åœ¨æ¨¡å‹ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>&lt;camera&gt;</code>, ç„¶åä½¿ç”¨ <code>camera_id</code> å‚æ•°å¯¹ <code>update_scene()</code> è¿›è¡Œæ¸²æŸ“. è®©æˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹ç°åœ¨çš„çŠ¶æ€:</li>
</ol>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'positions'</span>, physics.data.qpos)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'velocities'</span>, physics.data.qvel)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>positions [0.   0.   0.02 1.   0.   0.   0.  ]<br>velocities [0. 0. 0. 0. 0. 0.]</p>
</blockquote>
<p>é€Ÿåº¦å¾ˆå®¹æ˜“è§£é‡Š, 6 ä¸ª 0, æ¯ä¸ªè‡ªç”±åº¦å ä¸€ä¸ª. é•¿åº¦7çš„ä½ç½®å‘¢? æˆ‘ä»¬å¯ä»¥çœ‹åˆ°èº«ä½“æœ€åˆçš„ 2 å˜ç±³é«˜åº¦; åé¢çš„å››ä¸ªæ•°å­—æ˜¯ä¸‰ç»´æœå‘, ç”±å•ä½å››å…ƒæ•°å®šä¹‰. è¿™äº›è§„èŒƒåŒ–çš„å››å…ƒå‘é‡, å®ƒä»¬ä¿ç•™äº†æœå‘ç¾¤çš„æ‹“æ‰‘ç»“æ„, è¿™æ˜¯ <code>data.qpos</code> æ¯” <code>data.qvel</code> æ›´é•¿çš„åŸå› : ä¸‰ç»´æœå‘ç”¨ <strong>4</strong> ä¸ªæ•°å­—è¡¨ç¤º, è§’é€Ÿåº¦ç”¨ <strong>3</strong> ä¸ªæ•°å­—è¡¨ç¤º.</p>
<p><strong>"Tippe-top" è§†é¢‘</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Video of the tippe-top {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">duration = <span class="number">7</span>    <span class="comment"># (seconds)</span></span><br><span class="line">framerate = <span class="number">60</span>  <span class="comment"># (Hz)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and display video.</span></span><br><span class="line">frames = []</span><br><span class="line">physics.reset(<span class="number">0</span>)  <span class="comment"># Reset to keyframe 0 (load a saved state).</span></span><br><span class="line"><span class="keyword">while</span> physics.data.time &lt; duration:</span><br><span class="line">  physics.step()</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; (physics.data.time) * framerate:</span><br><span class="line">    pixels = physics.render(camera_id=<span class="string">'closeup'</span>)</span><br><span class="line">    frames.append(pixels)</span><br><span class="line"></span><br><span class="line">display_video(frames, framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="tippe-top.mp4" type="video/mp4">
</video>

<p><strong>ä» <code>physics.data</code> æµ‹é‡å€¼</strong></p>
<p><code>physics.data</code> ç»“æ„åŒ…å«ä»¿çœŸäº§ç”Ÿçš„æ‰€æœ‰åŠ¨æ€å˜é‡å’Œä¸­é—´ç»“æœ. è¿™äº›å°†åœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¸Šå‘ç”Ÿæ›´æ”¹.</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»¿çœŸ 2000 ä¸ªæ—¶é—´æ­¥, å¹¶ç»˜åˆ¶çƒä½“çš„çŠ¶æ€å’Œé«˜åº¦ä½œä¸ºæ—¶é—´çš„å‡½æ•°.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Measuring values {vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">timevals = []</span><br><span class="line">angular_velocity = []</span><br><span class="line">stem_height = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and save data</span></span><br><span class="line">physics.reset(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> physics.data.time &lt; duration:</span><br><span class="line">  physics.step()</span><br><span class="line">  timevals.append(physics.data.time)</span><br><span class="line">  angular_velocity.append(physics.data.qvel[<span class="number">3</span>:<span class="number">6</span>].copy())</span><br><span class="line">  stem_height.append(physics.named.data.geom_xpos[<span class="string">'stem'</span>, <span class="string">'z'</span>])</span><br><span class="line"></span><br><span class="line">dpi = <span class="number">100</span></span><br><span class="line">width = <span class="number">480</span></span><br><span class="line">height = <span class="number">640</span></span><br><span class="line">figsize = (width / dpi, height / dpi)</span><br><span class="line">_, ax = plt.subplots(<span class="number">2</span>, <span class="number">1</span>, figsize=figsize, dpi=dpi, sharex=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].plot(timevals, angular_velocity)</span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">'angular velocity'</span>)</span><br><span class="line">ax[<span class="number">0</span>].set_ylabel(<span class="string">'radians / second'</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">1</span>].plot(timevals, stem_height)</span><br><span class="line">ax[<span class="number">1</span>].set_xlabel(<span class="string">'time (seconds)'</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_ylabel(<span class="string">'meters'</span>)</span><br><span class="line">_ = ax[<span class="number">1</span>].set_title(<span class="string">'stem height'</span>)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:80%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/8.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/8.png" class="" title="measure"></a></div>

<h2 id="PyMJCF-æ•™ç¨‹"><a href="#PyMJCF-æ•™ç¨‹" class="headerlink" title="PyMJCF æ•™ç¨‹"></a><strong>PyMJCF æ•™ç¨‹</strong></h2><p>è¿™ä¸ªåº“ä¸º MuJoCo åŸºäº XML çš„ <a target="_blank" rel="noopener" href="http://www.mujoco.org/book/modeling.html">MJCF</a> ç‰©ç†å»ºæ¨¡è¯­è¨€æä¾›äº†ä¸€ä¸ª Python å¯¹è±¡æ¨¡å‹. è¿™ä¸ªåº“çš„ç›®æ ‡æ˜¯å…è®¸ç”¨æˆ·åœ¨ Python ä¸­è½»æ¾åœ°ä¸ MJCF æ¨¡å‹äº¤äº’å’Œä¿®æ”¹, ç±»ä¼¼äº JavaScript DOM å¯¹ HTML çš„ä½œç”¨.</p>
<p>è¿™ä¸ªåº“çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯èƒ½å¤Ÿè½»æ¾åœ°å°†å¤šä¸ªå•ç‹¬çš„ MJCF æ¨¡å‹ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„æ¨¡å‹. è‡ªåŠ¨æ¶ˆé™¤æ¥è‡ªä¸åŒæ¨¡å‹æˆ–åŒä¸€æ¨¡å‹çš„å¤šä¸ªå®ä¾‹çš„é‡å¤åç§°çš„æ­§ä¹‰.</p>
<p>ä¸€ä¸ªå…¸å‹çš„ç”¨ä¾‹æ˜¯å½“æˆ‘ä»¬æƒ³è¦æœºå™¨äººå…·æœ‰å¯å˜æ•°é‡çš„å…³èŠ‚æ—¶. è¿™æ˜¯å¯¹è¿åŠ¨å­¦çš„ä¸€ä¸ªæ ¹æœ¬æ€§æ”¹å˜, éœ€è¦ç¼–è¯‘ä¸€ä¸ªæ–°çš„ XML æè¿°ç¬¦å’Œæ–°çš„äºŒè¿›åˆ¶æ¨¡å‹.</p>
<p>ä¸‹é¢çš„ä»£ç ç‰‡æ®µå®ç°äº†è¿™ä¸ªåœºæ™¯, å¹¶æä¾›äº†è¿™ä¸ªåº“ç”¨ä¾‹çš„å¿«é€Ÿç¤ºä¾‹.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Leg</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  <span class="string">"""A 2-DoF leg with position actuators."""</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, length, rgba</span>):</span><br><span class="line">    self.model = mjcf.RootElement()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Defaults:</span></span><br><span class="line">    self.model.default.joint.damping = <span class="number">2</span></span><br><span class="line">    self.model.default.joint.<span class="built_in">type</span> = <span class="string">'hinge'</span></span><br><span class="line">    self.model.default.geom.<span class="built_in">type</span> = <span class="string">'capsule'</span></span><br><span class="line">    self.model.default.geom.rgba = rgba  <span class="comment"># Continued below...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Thigh:</span></span><br><span class="line">    self.thigh = self.model.worldbody.add(<span class="string">'body'</span>)</span><br><span class="line">    self.hip = self.thigh.add(<span class="string">'joint'</span>, axis=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">    self.thigh.add(<span class="string">'geom'</span>, fromto=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, length, <span class="number">0</span>, <span class="number">0</span>], size=[length/<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Hip:</span></span><br><span class="line">    self.shin = self.thigh.add(<span class="string">'body'</span>, pos=[length, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">    self.knee = self.shin.add(<span class="string">'joint'</span>, axis=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">    self.shin.add(<span class="string">'geom'</span>, fromto=[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -length], size=[length/<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Position actuators:</span></span><br><span class="line">    self.model.actuator.add(<span class="string">'position'</span>, joint=self.hip, kp=<span class="number">10</span>)</span><br><span class="line">    self.model.actuator.add(<span class="string">'position'</span>, joint=self.knee, kp=<span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
<p><code>Leg</code> ç±»æè¿°äº†ä¸€ä¸ªæŠ½è±¡çš„é“°æ¥è…¿, å…·æœ‰ä¸¤ä¸ªå…³èŠ‚å’Œç›¸åº”çš„ PD æ‰§è¡Œå™¨.</p>
<p>æ³¨æ„:</p>
<ul>
<li>MJCF å±æ€§ç›´æ¥å¯¹åº”äº <code>add()</code> æ–¹æ³•çš„å‚æ•°.</li>
<li>å½“å¼•ç”¨å…ƒç´ æ—¶, ä¾‹å¦‚å½“æŒ‡å®šæ‰§è¡Œå™¨è¿æ¥çš„å…³èŠ‚æ—¶, ä½¿ç”¨ MJCF å…ƒç´ æœ¬èº«, è€Œä¸æ˜¯åç§°å­—ç¬¦ä¸².</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">BODY_RADIUS = <span class="number">0.1</span></span><br><span class="line">BODY_SIZE = (BODY_RADIUS, BODY_RADIUS, BODY_RADIUS / <span class="number">2</span>)</span><br><span class="line">random_state = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_creature</span>(<span class="params">num_legs</span>):</span><br><span class="line">  <span class="string">"""Constructs a creature with `num_legs` legs."""</span></span><br><span class="line">  rgba = random_state.uniform([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">  model = mjcf.RootElement()</span><br><span class="line">  model.compiler.angle = <span class="string">'radian'</span>  <span class="comment"># Use radians.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Make the torso geom.</span></span><br><span class="line">  model.worldbody.add(</span><br><span class="line">      <span class="string">'geom'</span>, name=<span class="string">'torso'</span>, <span class="built_in">type</span>=<span class="string">'ellipsoid'</span>, size=BODY_SIZE, rgba=rgba)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Attach legs to equidistant sites on the circumference.</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_legs):</span><br><span class="line">    theta = <span class="number">2</span> * i * np.pi / num_legs</span><br><span class="line">    hip_pos = BODY_RADIUS * np.array([np.cos(theta), np.sin(theta), <span class="number">0</span>])</span><br><span class="line">    hip_site = model.worldbody.add(<span class="string">'site'</span>, pos=hip_pos, euler=[<span class="number">0</span>, <span class="number">0</span>, theta])</span><br><span class="line">    leg = Leg(length=BODY_RADIUS, rgba=rgba)</span><br><span class="line">    hip_site.attach(leg.model)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> model</span><br></pre></td></tr></tbody></table></figure>
<p><code>make_creature</code> å‡½æ•°ä½¿ç”¨ PyMJCF çš„ <code>attach()</code> æ–¹æ³•ä»ç¨‹åºä¸Šå°†è…¿é™„åŠ åˆ°èº¯å¹²ä¸Š. è¯·æ³¨æ„, åœ¨è¿™ä¸ªé˜¶æ®µ, èº¯å¹²å’Œè‡€éƒ¨é™„å±èŠ‚ç‚¹éƒ½æ˜¯ <code>worldbody</code> çš„å­èŠ‚ç‚¹, å› ä¸ºå®ƒä»¬çš„çˆ¶èŠ‚ç‚¹è¿˜æ²¡æœ‰å®ä¾‹åŒ–. æˆ‘ä»¬ç°åœ¨å°†åˆ¶ä½œä¸€ä¸ªå¸¦æœ‰æ–¹æ ¼åœ°æ¿å’Œä¸¤ç›ç¯çš„ arena, å¹¶å°†æˆ‘ä»¬çš„ç”Ÿç‰©æ”¾ç½®åœ¨ç½‘æ ¼ä¸­.</p>
<h3 id="å…­åªç”Ÿç‰©"><a href="#å…­åªç”Ÿç‰©" class="headerlink" title="å…­åªç”Ÿç‰©"></a><strong>å…­åªç”Ÿç‰©</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Six Creatures on a floor.{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">arena = mjcf.RootElement()</span><br><span class="line">chequered = arena.asset.add(<span class="string">'texture'</span>, <span class="built_in">type</span>=<span class="string">'2d'</span>, builtin=<span class="string">'checker'</span>, width=<span class="number">300</span>,</span><br><span class="line">                            height=<span class="number">300</span>, rgb1=[<span class="number">.2</span>, <span class="number">.3</span>, <span class="number">.4</span>], rgb2=[<span class="number">.3</span>, <span class="number">.4</span>, <span class="number">.5</span>])</span><br><span class="line">grid = arena.asset.add(<span class="string">'material'</span>, name=<span class="string">'grid'</span>, texture=chequered,</span><br><span class="line">                       texrepeat=[<span class="number">5</span>, <span class="number">5</span>], reflectance=<span class="number">.2</span>)</span><br><span class="line">arena.worldbody.add(<span class="string">'geom'</span>, <span class="built_in">type</span>=<span class="string">'plane'</span>, size=[<span class="number">2</span>, <span class="number">2</span>, <span class="number">.1</span>], material=grid)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [-<span class="number">2</span>, <span class="number">2</span>]:</span><br><span class="line">  arena.worldbody.add(<span class="string">'light'</span>, pos=[x, -<span class="number">1</span>, <span class="number">3</span>], <span class="built_in">dir</span>=[-x, <span class="number">1</span>, -<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Instantiate 6 creatures with 3 to 8 legs.</span></span><br><span class="line">creatures = [make_creature(num_legs=num_legs) <span class="keyword">for</span> num_legs <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">9</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Place them on a grid in the arena.</span></span><br><span class="line">height = <span class="number">.15</span></span><br><span class="line">grid = <span class="number">5</span> * BODY_RADIUS</span><br><span class="line">xpos, ypos, zpos = np.meshgrid([-grid, <span class="number">0</span>, grid], [<span class="number">0</span>, grid], [height])</span><br><span class="line"><span class="keyword">for</span> i, model <span class="keyword">in</span> <span class="built_in">enumerate</span>(creatures):</span><br><span class="line">  <span class="comment"># Place spawn sites on a grid.</span></span><br><span class="line">  spawn_pos = (xpos.flat[i], ypos.flat[i], zpos.flat[i])</span><br><span class="line">  spawn_site = arena.worldbody.add(<span class="string">'site'</span>, pos=spawn_pos, group=<span class="number">3</span>)</span><br><span class="line">  <span class="comment"># Attach to the arena at the spawn sites, with a free joint.</span></span><br><span class="line">  spawn_site.attach(model).add(<span class="string">'freejoint'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Instantiate the physics and render.</span></span><br><span class="line">physics = mjcf.Physics.from_mjcf_model(arena)</span><br><span class="line">PIL.Image.fromarray(physics.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/9.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/9.png" class="" title="creature"></a></div>

<p>å¤šè…¿ç”Ÿç‰©, éšæ—¶å‡†å¤‡æ¼«æ­¥! è®©æˆ‘ä»¬å¼•å…¥ä¸€äº›æ§åˆ¶å¹¶è§‚å¯Ÿå®ƒä»¬çš„ç§»åŠ¨. æˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ªå›ºå®šé¢‘ç‡å’Œéšæœºç›¸ä½çš„æ­£å¼¦å¼€ç¯æ§åˆ¶ä¿¡å·, è®°å½•è§†é¢‘å¸§å’Œèº¯å¹²å‡ ä½•ä½“çš„æ°´å¹³ä½ç½®, ä»¥ç»˜åˆ¶è¿åŠ¨è½¨è¿¹.</p>
<h3 id="è¿åŠ¨è§†é¢‘"><a href="#è¿åŠ¨è§†é¢‘" class="headerlink" title="è¿åŠ¨è§†é¢‘"></a><strong>è¿åŠ¨è§†é¢‘</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Video of the movement{vertical-output: true}</span></span><br><span class="line"><span class="comment">#@test {"timeout": 600}</span></span><br><span class="line"></span><br><span class="line">duration = <span class="number">10</span>   <span class="comment"># (Seconds)</span></span><br><span class="line">framerate = <span class="number">30</span>  <span class="comment"># (Hz)</span></span><br><span class="line">video = []</span><br><span class="line">pos_x = []</span><br><span class="line">pos_y = []</span><br><span class="line">torsos = []  <span class="comment"># List of torso geom elements.</span></span><br><span class="line">actuators = []  <span class="comment"># List of actuator elements.</span></span><br><span class="line"><span class="keyword">for</span> creature <span class="keyword">in</span> creatures:</span><br><span class="line">  torsos.append(creature.find(<span class="string">'geom'</span>, <span class="string">'torso'</span>))</span><br><span class="line">  actuators.extend(creature.find_all(<span class="string">'actuator'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Control signal frequency, phase, amplitude.</span></span><br><span class="line">freq = <span class="number">5</span></span><br><span class="line">phase = <span class="number">2</span> * np.pi * random_state.rand(<span class="built_in">len</span>(actuators))</span><br><span class="line">amp = <span class="number">0.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate, saving video frames and torso locations.</span></span><br><span class="line">physics.reset()</span><br><span class="line"><span class="keyword">while</span> physics.data.time &lt; duration:</span><br><span class="line">  <span class="comment"># Inject controls and step the physics.</span></span><br><span class="line">  physics.bind(actuators).ctrl = amp * np.sin(freq * physics.data.time + phase)</span><br><span class="line">  physics.step()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Save torso horizontal positions using bind().</span></span><br><span class="line">  pos_x.append(physics.bind(torsos).xpos[:, <span class="number">0</span>].copy())</span><br><span class="line">  pos_y.append(physics.bind(torsos).xpos[:, <span class="number">1</span>].copy())</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Save video frames.</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(video) &lt; physics.data.time * framerate:</span><br><span class="line">    pixels = physics.render()</span><br><span class="line">    video.append(pixels.copy())</span><br><span class="line"></span><br><span class="line">display_video(video, framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="creature.mp4" type="video/mp4">
</video>


<h3 id="è¿åŠ¨è½¨è¿¹"><a href="#è¿åŠ¨è½¨è¿¹" class="headerlink" title="è¿åŠ¨è½¨è¿¹"></a><strong>è¿åŠ¨è½¨è¿¹</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Movement trajectories{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">creature_colors = physics.bind(torsos).rgba[:, :<span class="number">3</span>]</span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">4</span>, <span class="number">4</span>))</span><br><span class="line">ax.set_prop_cycle(color=creature_colors)</span><br><span class="line">_ = ax.plot(pos_x, pos_y, linewidth=<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/10.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/10.png" class="" title="trojectory"></a></div>

<p>ä¸Šå›¾æ˜¾ç¤ºäº† creature ä½ç½®å¯¹åº”çš„è¿åŠ¨è½¨è¿¹. æ³¨æ„å¦‚ä½•ä½¿ç”¨ <code>physics.bind(torsos)</code> æ¥è®¿é—® <code>xpos</code> å’Œ <code>rgba</code> å€¼. ä¸€æ—¦ç”± <code>from_mjcf_model()</code> å®ä¾‹åŒ–äº† <code>Physics</code>, <code>bind()</code> æ–¹æ³•å°†å…¬å¼€ <code>mjcf</code> å…ƒç´ çš„å…³è” <code>mjData</code> å’Œ <code>mjModel</code> å­—æ®µ, ä»è€Œæä¾›å¯¹ä»¿çœŸä¸­æ‰€æœ‰é‡çš„ç»Ÿä¸€è®¿é—®.</p>
<h2 id="Composer-æ•™ç¨‹"><a href="#Composer-æ•™ç¨‹" class="headerlink" title="Composer æ•™ç¨‹"></a><strong>Composer æ•™ç¨‹</strong></h2><p>åœ¨æœ¬æ•™ç¨‹ä¸­, æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä»»åŠ¡, è¦æ±‚æˆ‘ä»¬çš„ â€œcreatureâ€ ä»¥è§„å®šçš„åŠ›æ¥æŒ‰åœ°æ¿ä¸Šçš„ä¸€ä¸ªå˜è‰²æŒ‰é’®. æˆ‘ä»¬é¦–å…ˆå°†è§’è‰²è®¾å®šä¸º <code>composer.Entity</code>:</p>
<h3 id="Creature-ç±»"><a href="#Creature-ç±»" class="headerlink" title="Creature ç±»"></a><strong><code>Creature</code> ç±»</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title The `Creature` class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Creature</span>(composer.Entity):</span><br><span class="line">  <span class="string">"""A multi-legged creature derived from `composer.Entity`."""</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_build</span>(<span class="params">self, num_legs</span>):</span><br><span class="line">    self._model = make_creature(num_legs)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_build_observables</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> CreatureObservables(self)</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">mjcf_model</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self._model</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">actuators</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(self._model.find_all(<span class="string">'actuator'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add simple observable features for joint angles and velocities.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreatureObservables</span>(composer.Observables):</span><br><span class="line"></span><br><span class="line"><span class="meta">  @composer.observable</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">joint_positions</span>(<span class="params">self</span>):</span><br><span class="line">    all_joints = self._entity.mjcf_model.find_all(<span class="string">'joint'</span>)</span><br><span class="line">    <span class="keyword">return</span> observable.MJCFFeature(<span class="string">'qpos'</span>, all_joints)</span><br><span class="line"></span><br><span class="line"><span class="meta">  @composer.observable</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">joint_velocities</span>(<span class="params">self</span>):</span><br><span class="line">    all_joints = self._entity.mjcf_model.find_all(<span class="string">'joint'</span>)</span><br><span class="line">    <span class="keyword">return</span> observable.MJCFFeature(<span class="string">'qvel'</span>, all_joints)</span><br></pre></td></tr></tbody></table></figure>
<p><code>Creature</code> å®ä½“åŒ…æ‹¬å…³èŠ‚è§’åº¦å’Œé€Ÿåº¦çš„é€šç”¨ Observables. å› ä¸º <code>find_all()</code> æ˜¯åœ¨ <code>Creature</code> çš„ MJCF æ¨¡å‹ä¸Šè°ƒç”¨çš„, å®ƒåªä¼šè¿”å›ç”Ÿç‰©çš„è…¿éƒ¨å…³èŠ‚, è€Œä¸æ˜¯å®ƒå°†è¿æ¥åˆ°ä¸–ç•Œçš„â€œè‡ªç”±â€å…³èŠ‚. æ³¨æ„, Composer å®ä½“åº”è¯¥é‡å†™ <code>_build</code> å’Œ <code>_build_observables</code> æ–¹æ³•, è€Œä¸æ˜¯ <code>__init__</code>. åœ¨åŸºç±»ä¸­å®ç° <code>__init__</code> è°ƒç”¨ <code>_build</code> å’Œ <code>_build_observables</code>, æŒ‰æ­¤é¡ºåºï¼Œä»¥ç¡®ä¿å®ä½“çš„ MJCF æ¨¡å‹åœ¨å…¶ observables ä¹‹å‰åˆ›å»º. è¿™æ˜¯ä¸€ç§è®¾è®¡é€‰æ‹©, å…è®¸ç”¨æˆ·å°† observables å¼•ç”¨ä¸ºå±æ€§(<code>entity.observables.foo</code>), åŒæ—¶ä»ç„¶æ¸…æ™°åœ°è¡¨æ˜å“ªäº›å±æ€§æ˜¯ observables. æœ‰çŠ¶æ€çš„ <code>Button</code> ç±»æ´¾ç”Ÿè‡ª <code>composer.Entity</code>, å¹¶å®ç° <code>initialize_episode</code> å’Œ <code>after_substep</code> å›è°ƒå‡½æ•°.</p>
<h3 id="Button-ç±»"><a href="#Button-ç±»" class="headerlink" title="Button ç±»"></a><strong><code>Button</code> ç±»</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title The `Button` class</span></span><br><span class="line">NUM_SUBSTEPS = <span class="number">25</span>  <span class="comment"># The number of physics substeps per control timestep.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span>(composer.Entity):</span><br><span class="line">  <span class="string">"""A button Entity which changes colour when pressed with certain force."""</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_build</span>(<span class="params">self, target_force_range=(<span class="params"><span class="number">5</span>, <span class="number">10</span></span>)</span>):</span><br><span class="line">    self._min_force, self._max_force = target_force_range</span><br><span class="line">    self._mjcf_model = mjcf.RootElement()</span><br><span class="line">    self._geom = self._mjcf_model.worldbody.add(</span><br><span class="line">        <span class="string">'geom'</span>, <span class="built_in">type</span>=<span class="string">'cylinder'</span>, size=[<span class="number">0.25</span>, <span class="number">0.02</span>], rgba=[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">    self._site = self._mjcf_model.worldbody.add(</span><br><span class="line">        <span class="string">'site'</span>, <span class="built_in">type</span>=<span class="string">'cylinder'</span>, size=self._geom.size*<span class="number">1.01</span>, rgba=[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">    self._sensor = self._mjcf_model.sensor.add(<span class="string">'touch'</span>, site=self._site)</span><br><span class="line">    self._num_activated_steps = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_build_observables</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> ButtonObservables(self)</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">mjcf_model</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self._mjcf_model</span><br><span class="line">  <span class="comment"># Update the activation (and colour) if the desired force is applied.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">_update_activation</span>(<span class="params">self, physics</span>):</span><br><span class="line">    current_force = physics.bind(self.touch_sensor).sensordata[<span class="number">0</span>]</span><br><span class="line">    self._is_activated = (current_force &gt;= self._min_force <span class="keyword">and</span></span><br><span class="line">                          current_force &lt;= self._max_force)</span><br><span class="line">    physics.bind(self._geom).rgba = (</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>] <span class="keyword">if</span> self._is_activated <span class="keyword">else</span> [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">    self._num_activated_steps += <span class="built_in">int</span>(self._is_activated)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize_episode</span>(<span class="params">self, physics, random_state</span>):</span><br><span class="line">    self._reward = <span class="number">0.0</span></span><br><span class="line">    self._num_activated_steps = <span class="number">0</span></span><br><span class="line">    self._update_activation(physics)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">after_substep</span>(<span class="params">self, physics, random_state</span>):</span><br><span class="line">    self._update_activation(physics)</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">touch_sensor</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self._sensor</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">num_activated_steps</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self._num_activated_steps</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ButtonObservables</span>(composer.Observables):</span><br><span class="line">  <span class="string">"""A touch sensor which averages contact force over physics substeps."""</span></span><br><span class="line"><span class="meta">  @composer.observable</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">touch_force</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> observable.MJCFFeature(<span class="string">'sensordata'</span>, self._entity.touch_sensor,</span><br><span class="line">                                  buffer_size=NUM_SUBSTEPS, aggregator=<span class="string">'mean'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨æ„æŒ‰é’®å¦‚ä½•åœ¨æŒ‡å®šåŠ›æŒ‰ä¸‹æœŸé—´è®¡ç®— sub-steps çš„æ•°é‡. å®ƒè¿˜æš´éœ²äº†æ–½åŠ åœ¨æŒ‰é’®ä¸Šçš„åŠ›çš„ <code>Observable</code>, å…¶å€¼æ˜¯ç‰©ç†æ—¶é—´æ­¥é•¿çš„è¯»æ•°å¹³å‡å€¼.</p>
<p>æˆ‘ä»¬å¯¼å…¥äº†ä¸€äº› <code>variation</code> æ¨¡å—å’Œä¸€ä¸ª arena factory:</p>
<h3 id="ä½¿ç”¨-composer-variation-çš„éšæœºåˆå§‹åŒ–å™¨"><a href="#ä½¿ç”¨-composer-variation-çš„éšæœºåˆå§‹åŒ–å™¨" class="headerlink" title="ä½¿ç”¨ composer.variation çš„éšæœºåˆå§‹åŒ–å™¨"></a><strong>ä½¿ç”¨ <code>composer.variation</code> çš„éšæœºåˆå§‹åŒ–å™¨</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Random initialiser using `composer.variation`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UniformCircle</span>(variation.Variation):</span><br><span class="line">  <span class="string">"""A uniformly sampled horizontal point on a circle of radius `distance`."""</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, distance</span>):</span><br><span class="line">    self._distance = distance</span><br><span class="line">    self._heading = distributions.Uniform(<span class="number">0</span>, <span class="number">2</span>*np.pi)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, initial_value=<span class="literal">None</span>, current_value=<span class="literal">None</span>, random_state=<span class="literal">None</span></span>):</span><br><span class="line">    distance, heading = variation.evaluate(</span><br><span class="line">        (self._distance, self._heading), random_state=random_state)</span><br><span class="line">    <span class="keyword">return</span> (distance*np.cos(heading), distance*np.sin(heading), <span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="PressWithSpecificForce-ä»»åŠ¡"><a href="#PressWithSpecificForce-ä»»åŠ¡" class="headerlink" title="PressWithSpecificForce ä»»åŠ¡"></a><strong><code>PressWithSpecificForce</code> ä»»åŠ¡</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title The `PressWithSpecificForce` task</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PressWithSpecificForce</span>(composer.Task):</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, creature</span>):</span><br><span class="line">    self._creature = creature</span><br><span class="line">    self._arena = floors.Floor()</span><br><span class="line">    self._arena.add_free_entity(self._creature)</span><br><span class="line">    self._arena.mjcf_model.worldbody.add(<span class="string">'light'</span>, pos=(<span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>))</span><br><span class="line">    self._button = Button()</span><br><span class="line">    self._arena.attach(self._button)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Configure initial poses</span></span><br><span class="line">    self._creature_initial_pose = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.15</span>)</span><br><span class="line">    button_distance = distributions.Uniform(<span class="number">0.5</span>, <span class="number">.75</span>)</span><br><span class="line">    self._button_initial_pose = UniformCircle(button_distance)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Configure variators</span></span><br><span class="line">    self._mjcf_variator = variation.MJCFVariator()</span><br><span class="line">    self._physics_variator = variation.PhysicsVariator()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Configure and enable observables</span></span><br><span class="line">    pos_corrptor = noises.Additive(distributions.Normal(scale=<span class="number">0.01</span>))</span><br><span class="line">    self._creature.observables.joint_positions.corruptor = pos_corrptor</span><br><span class="line">    self._creature.observables.joint_positions.enabled = <span class="literal">True</span></span><br><span class="line">    vel_corruptor = noises.Multiplicative(distributions.LogNormal(sigma=<span class="number">0.01</span>))</span><br><span class="line">    self._creature.observables.joint_velocities.corruptor = vel_corruptor</span><br><span class="line">    self._creature.observables.joint_velocities.enabled = <span class="literal">True</span></span><br><span class="line">    self._button.observables.touch_force.enabled = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_button</span>(<span class="params">physics</span>):</span><br><span class="line">      button_pos, _ = self._button.get_pose(physics)</span><br><span class="line">      <span class="keyword">return</span> self._creature.global_vector_to_local_frame(physics, button_pos)</span><br><span class="line"></span><br><span class="line">    self._task_observables = {}</span><br><span class="line">    self._task_observables[<span class="string">'button_position'</span>] = observable.<span class="type">Generic</span>(to_button)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> obs <span class="keyword">in</span> self._task_observables.values():</span><br><span class="line">      obs.enabled = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    self.control_timestep = NUM_SUBSTEPS * self.physics_timestep</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">root_entity</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self._arena</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">task_observables</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self._task_observables</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize_episode_mjcf</span>(<span class="params">self, random_state</span>):</span><br><span class="line">    self._mjcf_variator.apply_variations(random_state)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize_episode</span>(<span class="params">self, physics, random_state</span>):</span><br><span class="line">    self._physics_variator.apply_variations(physics, random_state)</span><br><span class="line">    creature_pose, button_pose = variation.evaluate(</span><br><span class="line">        (self._creature_initial_pose, self._button_initial_pose),</span><br><span class="line">        random_state=random_state)</span><br><span class="line">    self._creature.set_pose(physics, position=creature_pose)</span><br><span class="line">    self._button.set_pose(physics, position=button_pose)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">get_reward</span>(<span class="params">self, physics</span>):</span><br><span class="line">    <span class="keyword">return</span> self._button.num_activated_steps / NUM_SUBSTEPS</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å®ä¾‹åŒ–ç¯å¢ƒ"><a href="#å®ä¾‹åŒ–ç¯å¢ƒ" class="headerlink" title="å®ä¾‹åŒ–ç¯å¢ƒ"></a><strong>å®ä¾‹åŒ–ç¯å¢ƒ</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Instantiating an environment{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">creature = Creature(num_legs=<span class="number">4</span>)</span><br><span class="line">task = PressWithSpecificForce(creature)</span><br><span class="line">env = composer.Environment(task, random_state=np.random.RandomState(<span class="number">42</span>))</span><br><span class="line"></span><br><span class="line">env.reset()</span><br><span class="line">PIL.Image.fromarray(env.physics.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/11.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/11.png" class="" title="environment"></a></div>

<h2 id="The-Control-Suite"><a href="#The-Control-Suite" class="headerlink" title="The Control Suite"></a><strong>The <em>Control Suite</em></strong></h2><p><strong>Control Suite</strong> æ˜¯ä¸€ç»„ç¨³å®šçš„, ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ä»»åŠ¡, æ—¨åœ¨ä½œä¸ºæŒç»­æ§åˆ¶ learning agents çš„åŸºå‡†(benchmark). ä»»åŠ¡æ˜¯ä½¿ç”¨åŸºæœ¬çš„ MuJoCo å°è£…æ¥å£ç¼–å†™çš„. æ ‡å‡†åŒ–çš„è¡ŒåŠ¨(action), è§‚å¯Ÿ(observation)å’Œå¥–åŠ±(reward)ç»“æ„ä½¿ suit-wide çš„åŸºå‡†æµ‹è¯•å˜å¾—ç®€å•, å­¦ä¹ æ›²çº¿ä¹Ÿæ˜“äºè§£é‡Š. ä¸ºäº†ä¾¿äºè¿›è¡ŒåŸºå‡†æµ‹è¯•, Control Suite åŸŸä¸åº”è¯¥è¢«ä¿®æ”¹. æœ‰å…³åŸºå‡†æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜…æˆ‘ä»¬çš„åŸå§‹<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1801.00690">æ–‡ç« </a>.</p>
<p>è§£å†³çš„åŸºå‡†æµ‹è¯•ä»»åŠ¡çš„è§†é¢‘å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=rAai4QzcYbs&amp;feature=youtu.be">è¿™é‡Œ</a>æ‰¾åˆ°.</p>
<p>è¯¥ suite ä¸ºè¿­ä»£ä»»åŠ¡æä¾›äº†æ–¹ä¾¿çš„æ¨¡å—çº§å…ƒç»„:</p>
<h3 id="éå†ä»»åŠ¡"><a href="#éå†ä»»åŠ¡" class="headerlink" title="éå†ä»»åŠ¡"></a><strong>éå†ä»»åŠ¡</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Iterating over tasks{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">max_len = <span class="built_in">max</span>(<span class="built_in">len</span>(d) <span class="keyword">for</span> d, _ <span class="keyword">in</span> suite.BENCHMARKING)</span><br><span class="line"><span class="keyword">for</span> domain, task <span class="keyword">in</span> suite.BENCHMARKING:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f'<span class="subst">{domain:&lt;{max_len}</span>}  <span class="subst">{task}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŠ è½½å’Œä»¿çœŸä¸€ä¸ª-suite-ä»»åŠ¡"><a href="#åŠ è½½å’Œä»¿çœŸä¸€ä¸ª-suite-ä»»åŠ¡" class="headerlink" title="åŠ è½½å’Œä»¿çœŸä¸€ä¸ª suite ä»»åŠ¡"></a><strong>åŠ è½½å’Œä»¿çœŸä¸€ä¸ª <code>suite</code> ä»»åŠ¡</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Loading and simulating a `suite` task{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the environment</span></span><br><span class="line">random_state = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">env = suite.load(<span class="string">'hopper'</span>, <span class="string">'stand'</span>, task_kwargs={<span class="string">'random'</span>: random_state})</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate episode with random actions</span></span><br><span class="line">duration = <span class="number">4</span>  <span class="comment"># Seconds</span></span><br><span class="line">frames = []</span><br><span class="line">ticks = []</span><br><span class="line">rewards = []</span><br><span class="line">observations = []</span><br><span class="line"></span><br><span class="line">spec = env.action_spec()</span><br><span class="line">time_step = env.reset()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> env.physics.data.time &lt; duration:</span><br><span class="line"></span><br><span class="line">  action = random_state.uniform(spec.minimum, spec.maximum, spec.shape)</span><br><span class="line">  time_step = env.step(action)</span><br><span class="line"></span><br><span class="line">  camera0 = env.physics.render(camera_id=<span class="number">0</span>, height=<span class="number">200</span>, width=<span class="number">200</span>)</span><br><span class="line">  camera1 = env.physics.render(camera_id=<span class="number">1</span>, height=<span class="number">200</span>, width=<span class="number">200</span>)</span><br><span class="line">  frames.append(np.hstack((camera0, camera1)))</span><br><span class="line">  rewards.append(time_step.reward)</span><br><span class="line">  observations.append(copy.deepcopy(time_step.observation))</span><br><span class="line">  ticks.append(env.physics.data.time)</span><br><span class="line"></span><br><span class="line">html_video = display_video(frames, framerate=<span class="number">1.</span>/env.control_timestep())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show video and plot reward and observations</span></span><br><span class="line">num_sensors = <span class="built_in">len</span>(time_step.observation)</span><br><span class="line"></span><br><span class="line">_, ax = plt.subplots(<span class="number">1</span> + num_sensors, <span class="number">1</span>, sharex=<span class="literal">True</span>, figsize=(<span class="number">4</span>, <span class="number">8</span>))</span><br><span class="line">ax[<span class="number">0</span>].plot(ticks, rewards)</span><br><span class="line">ax[<span class="number">0</span>].set_ylabel(<span class="string">'reward'</span>)</span><br><span class="line">ax[-<span class="number">1</span>].set_xlabel(<span class="string">'time'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, key <span class="keyword">in</span> <span class="built_in">enumerate</span>(time_step.observation):</span><br><span class="line">  data = np.asarray([observations[j][key] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(observations))])</span><br><span class="line">  ax[i+<span class="number">1</span>].plot(ticks, data, label=key)</span><br><span class="line">  ax[i+<span class="number">1</span>].set_ylabel(key)</span><br><span class="line"></span><br><span class="line">html_video</span><br></pre></td></tr></tbody></table></figure>
<div style="width:80%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/12.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/12.png" class="" title="suite"></a></div>

<video controls="">
     <source src="suite.mp4" type="video/mp4">
</video>


<h3 id="åœ¨-Control-Suite-ä¸­å¯è§†åŒ–æ¯ä¸ªåŸŸçš„ä¸€ä¸ªä»»åŠ¡çš„åˆå§‹çŠ¶æ€"><a href="#åœ¨-Control-Suite-ä¸­å¯è§†åŒ–æ¯ä¸ªåŸŸçš„ä¸€ä¸ªä»»åŠ¡çš„åˆå§‹çŠ¶æ€" class="headerlink" title="åœ¨ Control Suite ä¸­å¯è§†åŒ–æ¯ä¸ªåŸŸçš„ä¸€ä¸ªä»»åŠ¡çš„åˆå§‹çŠ¶æ€"></a><strong>åœ¨ Control Suite ä¸­å¯è§†åŒ–æ¯ä¸ªåŸŸçš„ä¸€ä¸ªä»»åŠ¡çš„åˆå§‹çŠ¶æ€</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Visualizing an initial state of one task per domain in the Control Suite</span></span><br><span class="line">domains_tasks = {domain: task <span class="keyword">for</span> domain, task <span class="keyword">in</span> suite.ALL_TASKS}</span><br><span class="line">random_state = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">num_domains = <span class="built_in">len</span>(domains_tasks)</span><br><span class="line">n_col = num_domains // <span class="built_in">int</span>(np.sqrt(num_domains))</span><br><span class="line">n_row = num_domains // n_col + <span class="built_in">int</span>(<span class="number">0</span> &lt; num_domains % n_col)</span><br><span class="line">_, ax = plt.subplots(n_row, n_col, figsize=(<span class="number">12</span>, <span class="number">12</span>))</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> ax.flat:</span><br><span class="line">  a.axis(<span class="string">'off'</span>)</span><br><span class="line">  a.grid(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Iterating over all <span class="subst">{num_domains}</span> domains in the Suite:'</span>)</span><br><span class="line"><span class="keyword">for</span> j, [domain, task] <span class="keyword">in</span> <span class="built_in">enumerate</span>(domains_tasks.items()):</span><br><span class="line">  <span class="built_in">print</span>(domain, task)</span><br><span class="line"></span><br><span class="line">  env = suite.load(domain, task, task_kwargs={<span class="string">'random'</span>: random_state})</span><br><span class="line">  timestep = env.reset()</span><br><span class="line">  pixels = env.physics.render(height=<span class="number">200</span>, width=<span class="number">200</span>, camera_id=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  ax.flat[j].imshow(pixels)</span><br><span class="line">  ax.flat[j].set_title(domain + <span class="string">': '</span> + task)</span><br><span class="line"></span><br><span class="line">clear_output()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:90%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/13.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/13.png" class="" title="initial"></a></div>

<h2 id="è¿åŠ¨"><a href="#è¿åŠ¨" class="headerlink" title="è¿åŠ¨"></a><strong>è¿åŠ¨</strong></h2><h3 id="äººç‰©æ¨¡å‹åœ¨æœ‰éšœç¢ç‰©çš„èµ°å»Šä¸Šå¥”è·‘"><a href="#äººç‰©æ¨¡å‹åœ¨æœ‰éšœç¢ç‰©çš„èµ°å»Šä¸Šå¥”è·‘" class="headerlink" title="äººç‰©æ¨¡å‹åœ¨æœ‰éšœç¢ç‰©çš„èµ°å»Šä¸Šå¥”è·‘"></a><strong>äººç‰©æ¨¡å‹åœ¨æœ‰éšœç¢ç‰©çš„èµ°å»Šä¸Šå¥”è·‘</strong></h3><p>ä½œä¸ºä¸€ä¸ªä½¿ç”¨ç§»åŠ¨åŸºç¡€ç»“æ„æ¥æ„å»º RL ç¯å¢ƒçš„ç¤ºä¾‹, è€ƒè™‘å°†ä¸€ä¸ªäººå½¢è§’è‰²æ”¾ç½®åœ¨ä¸€ä¸ªæœ‰å¢™å£çš„èµ°å»Šä¸­, å¹¶æŒ‡å®šä¸€ä¸ªä»»åŠ¡, è¯¥ä»»åŠ¡æŒ‡å®šäººå½¢è§’è‰²å°†é€šè¿‡æ²¿ç€è¿™ä¸ªèµ°å»Šå¥”è·‘, ä½¿ç”¨è§†è§‰ç»•è¿‡å¢™å£éšœç¢ç‰©æ¥è·å¾—å¥–åŠ±. æˆ‘ä»¬å°†ç¯å¢ƒå®ä¾‹åŒ–ä¸º Walker, Arena å’Œ Task çš„ç»„åˆ, å¦‚ä¸‹æ‰€ç¤º. é¦–å…ˆ, æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªä½ç½®æ§åˆ¶çš„ CMU äººå½¢è§’è‰².</p>
<p><strong>ä¸€ä¸ªä½ç½®æ§åˆ¶ <code>cmu_humanoid</code></strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title A position controlled `cmu_humanoid`</span></span><br><span class="line"></span><br><span class="line">walker = cmu_humanoid.CMUHumanoidPositionControlledV2020(</span><br><span class="line">    observable_options={<span class="string">'egocentric_camera'</span>: <span class="built_in">dict</span>(enabled=<span class="literal">True</span>)})</span><br></pre></td></tr></tbody></table></figure>
<p>æ¥ä¸‹æ¥, æˆ‘ä»¬å»ºé€ äº†ä¸€ä¸ªèµ°å»Šå½¢çŠ¶çš„ arena, å®ƒè¢«å¢™å£æŒ¡ä½.</p>
<p><strong>ä¸€ä¸ªå¸¦æœ‰å¢™å£éšœç¢çš„èµ°å»Š arena</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title A corridor arena with wall obstacles</span></span><br><span class="line"></span><br><span class="line">arena = corridor_arenas.WallsCorridor(</span><br><span class="line">    wall_gap=<span class="number">3.</span>,</span><br><span class="line">    wall_width=distributions.Uniform(<span class="number">2.</span>, <span class="number">3.</span>),</span><br><span class="line">    wall_height=distributions.Uniform(<span class="number">2.5</span>, <span class="number">3.5</span>),</span><br><span class="line">    corridor_width=<span class="number">4.</span>,</span><br><span class="line">    corridor_length=<span class="number">30.</span>,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p>ä»»åŠ¡æ„é€ å‡½æ•°å°† walker æ”¾ç½®åœ¨arena ä¸­.</p>
<p><strong>åœ¨ arena ä¸­å¯¼èˆªçš„ä»»åŠ¡</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title A task to navigate the arena</span></span><br><span class="line"></span><br><span class="line">task = corridor_tasks.RunThroughCorridor(</span><br><span class="line">    walker=walker,</span><br><span class="line">    arena=arena,</span><br><span class="line">    walker_spawn_position=(<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">    target_velocity=<span class="number">3.0</span>,</span><br><span class="line">    physics_timestep=<span class="number">0.005</span>,</span><br><span class="line">    control_timestep=<span class="number">0.03</span>,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p>æœ€å, ä¸€ä¸ªå¥–åŠ± agent ä»¥ç‰¹å®šé€Ÿåº¦è·‘ä¸‹èµ°å»Šçš„ä»»åŠ¡è¢«å®ä¾‹åŒ–ä¸º <code>composer.Environment</code>.</p>
<p><strong><code>RunThroughCorridor</code></strong> <strong>ç¯å¢ƒ</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title The `RunThroughCorridor` environment</span></span><br><span class="line"></span><br><span class="line">env = composer.Environment(</span><br><span class="line">    task=task,</span><br><span class="line">    time_limit=<span class="number">10</span>,</span><br><span class="line">    random_state=np.random.RandomState(<span class="number">42</span>),</span><br><span class="line">    strip_singleton_obs_buffer_dim=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">env.reset()</span><br><span class="line">pixels = []</span><br><span class="line"><span class="keyword">for</span> camera_id <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">  pixels.append(env.physics.render(camera_id=camera_id, width=<span class="number">240</span>))</span><br><span class="line">PIL.Image.fromarray(np.hstack(pixels))</span><br></pre></td></tr></tbody></table></figure>
<div style="width:80%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/14.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/14.png" class="" title="run"></a></div>

<h3 id="å¤šæ™ºèƒ½ä½“è¶³çƒ"><a href="#å¤šæ™ºèƒ½ä½“è¶³çƒ" class="headerlink" title="å¤šæ™ºèƒ½ä½“è¶³çƒ"></a><strong>å¤šæ™ºèƒ½ä½“è¶³çƒ</strong></h3><p>å¤šæ™ºèƒ½ä½“è¶³çƒç¯å¢ƒ(<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1902.07151">æ–‡ç« </a>)å»ºç«‹åœ¨ Composer å’Œ Locomotion åº“çš„åŸºç¡€ä¸Š, éµå¾ª Walkers, Arena å’Œ Task çš„ä¸€è‡´ä»»åŠ¡ç»“æ„, å…¶ä¸­æˆ‘ä»¬å¼•å…¥å¤šä¸ª walkers, è€Œä¸æ˜¯å•ä¸ª, å¯ä»¥åœ¨åŒä¸€åœºæ™¯ä¸­ç›¸äº’è¿›è¡Œç‰©ç†äº¤äº’. ä¸‹é¢çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç®€å•çš„ 5 è‡ªç”±åº¦ <code>BoxHead</code> walker ç±»å‹å®ä¾‹åŒ–ä¸€ä¸ª 2-vs-2 çš„å¤šä»£ç†è¶³çƒç¯å¢ƒ.</p>
<p><strong>2-v-2 <code>Boxhead</code> è¶³çƒ</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title 2-v-2 `Boxhead` soccer</span></span><br><span class="line"></span><br><span class="line">random_state = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">env = soccer.load(</span><br><span class="line">    team_size=<span class="number">2</span>,</span><br><span class="line">    time_limit=<span class="number">45.</span>,</span><br><span class="line">    random_state=random_state,</span><br><span class="line">    disable_walker_contacts=<span class="literal">False</span>,</span><br><span class="line">    walker_type=soccer.WalkerType.BOXHEAD,</span><br><span class="line">)</span><br><span class="line">env.reset()</span><br><span class="line">pixels = []</span><br><span class="line"><span class="comment"># Select a random subset of 6 cameras (soccer envs have lots of cameras)</span></span><br><span class="line">cameras = random_state.choice(env.physics.model.ncam, <span class="number">6</span>, replace=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> camera_id <span class="keyword">in</span> cameras:</span><br><span class="line">  pixels.append(env.physics.render(camera_id=camera_id, width=<span class="number">240</span>))</span><br><span class="line">image = np.vstack((np.hstack(pixels[:<span class="number">3</span>]), np.hstack(pixels[<span class="number">3</span>:])))</span><br><span class="line">PIL.Image.fromarray(image)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:80%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/15.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/15.png" class="" title="boxhead"></a></div>

<p>å…¶ä¸­çš„ walker å¯ä»¥è¢«ç®€å•åœ°æ›¿æ¢ä¸º <code>WalkerType.ANT</code>:</p>
<p><strong>3-v-3 <code>Ant</code> è¶³çƒ</strong></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title 3-v-3 `Ant` soccer</span></span><br><span class="line"></span><br><span class="line">random_state = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">env = soccer.load(</span><br><span class="line">    team_size=<span class="number">3</span>,</span><br><span class="line">    time_limit=<span class="number">45.</span>,</span><br><span class="line">    random_state=random_state,</span><br><span class="line">    disable_walker_contacts=<span class="literal">False</span>,</span><br><span class="line">    walker_type=soccer.WalkerType.ANT,</span><br><span class="line">)</span><br><span class="line">env.reset()</span><br><span class="line"></span><br><span class="line">pixels = []</span><br><span class="line">cameras = random_state.choice(env.physics.model.ncam, <span class="number">6</span>, replace=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> camera_id <span class="keyword">in</span> cameras:</span><br><span class="line">  pixels.append(env.physics.render(camera_id=camera_id, width=<span class="number">240</span>))</span><br><span class="line">image = np.vstack((np.hstack(pixels[:<span class="number">3</span>]), np.hstack(pixels[<span class="number">3</span>:])))</span><br><span class="line">PIL.Image.fromarray(image)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:80%;margin:auto"><a href="/2023/04/17/dm-control-tutorial/16.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/17/dm-control-tutorial/16.png" class="" title="ant"></a></div>

<h2 id="Manipulation"><a href="#Manipulation" class="headerlink" title="Manipulation"></a><strong>Manipulation</strong></h2><p><code>manipulation</code> æ¨¡å—æä¾›äº†ä¸€ä¸ªæœºæ¢°è‡‚, ä¸€ç»„ç®€å•çš„å¯¹è±¡, ä»¥åŠä¸ºæ“ä½œä»»åŠ¡æ„å»ºå¥–åŠ±å‡½æ•°çš„å·¥å…·.</p>
<h3 id="åˆ—å‡ºæ‰€æœ‰-manipulation-ä»»åŠ¡"><a href="#åˆ—å‡ºæ‰€æœ‰-manipulation-ä»»åŠ¡" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰ manipulation ä»»åŠ¡"></a><strong>åˆ—å‡ºæ‰€æœ‰ <code>manipulation</code> ä»»åŠ¡</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Listing all `manipulation` tasks{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># `ALL` is a tuple containing the names of all of the environments in the suite.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'\n'</span>.join(manipulation.ALL))</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åˆ—å‡ºä½¿ç”¨è§†è§‰çš„-manipulation-ä»»åŠ¡"><a href="#åˆ—å‡ºä½¿ç”¨è§†è§‰çš„-manipulation-ä»»åŠ¡" class="headerlink" title="åˆ—å‡ºä½¿ç”¨è§†è§‰çš„ manipulation ä»»åŠ¡"></a><strong>åˆ—å‡ºä½¿ç”¨è§†è§‰çš„ <code>manipulation</code> ä»»åŠ¡</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Listing `manipulation` tasks that use vision{vertical-output: true}</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'\n'</span>.join(manipulation.get_environments_by_tag(<span class="string">'vision'</span>)))</span><br></pre></td></tr></tbody></table></figure>
<h3 id="åŠ è½½å’Œæ¨¡æ‹Ÿ-manipulation-ä»»åŠ¡"><a href="#åŠ è½½å’Œæ¨¡æ‹Ÿ-manipulation-ä»»åŠ¡" class="headerlink" title="åŠ è½½å’Œæ¨¡æ‹Ÿ manipulation ä»»åŠ¡"></a><strong>åŠ è½½å’Œæ¨¡æ‹Ÿ <code>manipulation</code> ä»»åŠ¡</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Loading and simulating a `manipulation` task{vertical-output: true}</span></span><br><span class="line"></span><br><span class="line">env = manipulation.load(<span class="string">'stack_2_of_3_bricks_random_order_vision'</span>, seed=<span class="number">42</span>)</span><br><span class="line">action_spec = env.action_spec()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_random_action</span>():</span><br><span class="line">  <span class="keyword">return</span> env.random_state.uniform(</span><br><span class="line">      low=action_spec.minimum,</span><br><span class="line">      high=action_spec.maximum,</span><br><span class="line">  ).astype(action_spec.dtype, copy=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step the environment through a full episode using random actions and record</span></span><br><span class="line"><span class="comment"># the camera observations.</span></span><br><span class="line">frames = []</span><br><span class="line">timestep = env.reset()</span><br><span class="line">frames.append(timestep.observation[<span class="string">'front_close'</span>])</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> timestep.last():</span><br><span class="line">  timestep = env.step(sample_random_action())</span><br><span class="line">  frames.append(timestep.observation[<span class="string">'front_close'</span>])</span><br><span class="line">all_frames = np.concatenate(frames, axis=<span class="number">0</span>)</span><br><span class="line">display_video(all_frames, <span class="number">30</span>)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="manipulation.mp4" type="video/mp4">
</video>
</div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-04-17</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« å°‘å¸¥</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/dm-control/'>
                            dm_control
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E6%B1%89%E5%8C%96/'>
                            æ±‰åŒ–
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        ä»¥ä¸Š 
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://comment.shawshai.cn',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'ç•™ä¸‹ä½ çš„è¯„è®ºå§ã€‚', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 2021-2024 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>æ‘†è„±å†·æ°” åªå‘ä¸Šèµ°</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="//cdn.bootcss.com/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>


</html>