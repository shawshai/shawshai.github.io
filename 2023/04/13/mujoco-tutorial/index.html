<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="MuJoCo æ•™ç¨‹" />
    <meta name="hexo-theme-A4" content="v1.8.9" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>å°‘å¸¥çš„åšå®¢</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.1.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="å°‘å¸¥çš„åšå®¢" type="application/atom+xml">
</head>
    
    
    <body>
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">å°‘å¸¥çš„åšå®¢</a> 
            <span class="description">Shaw Shai&#39;s Blog</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">ğŸŒ„é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ“–æ–‡ç« </a></li>
            
        
            
                <li><a href="/about/">â›„å…³äº</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            MuJoCo æ•™ç¨‹
        </div>
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%89%E8%A3%85-MuJoCo"><span class="post-toc-text">å®‰è£… MuJoCo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="post-toc-text">æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AF%BC%E5%85%A5%E7%9B%B8%E5%85%B3%E5%9B%BE%E5%BD%A2%E5%92%8C%E7%BB%98%E5%9B%BE%E5%8C%85"><span class="post-toc-text">å¯¼å…¥ç›¸å…³å›¾å½¢å’Œç»˜å›¾åŒ…</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MuJoCo-%E5%9F%BA%E7%A1%80"><span class="post-toc-text">MuJoCo åŸºç¡€</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#mjModel"><span class="post-toc-text">mjModel</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Named-access"><span class="post-toc-text">Named access</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#mjData"><span class="post-toc-text">mjData</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%B8%B2%E6%9F%93%E3%80%81%E6%A8%A1%E6%8B%9F%E5%92%8C%E5%8A%A8%E7%94%BB"><span class="post-toc-text">åŸºæœ¬çš„æ¸²æŸ“ã€æ¨¡æ‹Ÿå’ŒåŠ¨ç”»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BB%BF%E7%9C%9F"><span class="post-toc-text">ä»¿çœŸ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%90%86%E8%A7%A3%E8%87%AA%E7%94%B1%E5%BA%A6"><span class="post-toc-text">ç†è§£è‡ªç”±åº¦</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%A4%BA%E4%BE%8B-%E7%94%A8%E8%87%AA%E5%8F%8D%E8%BD%AC%E7%9A%84%E2%80%9Ctippe-top%E2%80%9D%E6%A8%A1%E6%8B%9F%E8%87%AA%E7%94%B1%E4%BD%93"><span class="post-toc-text">ç¤ºä¾‹: ç”¨è‡ªåè½¬çš„â€œtippe-topâ€æ¨¡æ‹Ÿè‡ªç”±ä½“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B5%8B%E9%87%8F-mjData-%E4%B8%AD%E7%9A%84%E5%80%BC"><span class="post-toc-text">æµ‹é‡ mjData ä¸­çš„å€¼</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9E%E4%BE%8B-%E4%B8%80%E4%B8%AA%E6%B7%B7%E6%B2%8C%E6%91%86"><span class="post-toc-text">å®ä¾‹: ä¸€ä¸ªæ··æ²Œæ‘†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Timing"><span class="post-toc-text">Timing</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Chaos"><span class="post-toc-text">Chaos</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%97%B6%E9%97%B4%E6%AD%A5%E9%95%BF%E5%92%8C%E7%B2%BE%E5%BA%A6"><span class="post-toc-text">æ—¶é—´æ­¥é•¿å’Œç²¾åº¦</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%97%B6%E9%97%B4%E6%AD%A5%E9%95%BF%E5%92%8C%E6%95%9B%E6%95%A3%E6%80%A7"><span class="post-toc-text">æ—¶é—´æ­¥é•¿å’Œæ•›æ•£æ€§</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8E%A5%E8%A7%A6%E5%8A%9B"><span class="post-toc-text">æ¥è§¦åŠ›</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%86%E6%9E%90%E6%8E%A5%E8%A7%A6%E5%8A%9B"><span class="post-toc-text">åˆ†ææ¥è§¦åŠ›</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%91%A9%E6%93%A6%E5%8A%9B"><span class="post-toc-text">æ‘©æ“¦åŠ›</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%82%8C%E8%85%B1-%E6%89%A7%E8%A1%8C%E5%99%A8%E5%92%8C%E4%BC%A0%E6%84%9F%E5%99%A8"><span class="post-toc-text">è‚Œè…±, æ‰§è¡Œå™¨å’Œä¼ æ„Ÿå™¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%AB%98%E7%BA%A7%E6%B8%B2%E6%9F%93"><span class="post-toc-text">é«˜çº§æ¸²æŸ“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%90%AF%E7%94%A8%E9%80%8F%E6%98%8E%E5%BA%A6%E5%92%8C%E5%9D%90%E6%A0%87%E8%BD%B4%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="post-toc-text">å¯ç”¨é€æ˜åº¦å’Œåæ ‡è½´å¯è§†åŒ–</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B7%B1%E5%BA%A6%E6%B8%B2%E6%9F%93"><span class="post-toc-text">æ·±åº¦æ¸²æŸ“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%86%E5%89%B2%E6%B8%B2%E6%9F%93"><span class="post-toc-text">åˆ†å‰²æ¸²æŸ“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%9B%B8%E6%9C%BA%E7%9F%A9%E9%98%B5"><span class="post-toc-text">ç›¸æœºçŸ©é˜µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9C%BA%E6%99%AF"><span class="post-toc-text">ä¿®æ”¹åœºæ™¯</span></a></li></ol></li></ol>
            
        
        <div class=".article-gallery"><div align="center">æœ¬æ–‡ä¸º MuJoCo å®˜æ–¹æ•™ç¨‹çš„ç®€å•ç¿»è¯‘. </div>

<span id="more"></span>
<p>åŸæ–‡é“¾æ¥å¦‚ä¸‹:</p>
<p><a target="_blank" rel="noopener" href="https://colab.research.google.com/github/deepmind/mujoco/blob/main/python/tutorial.ipynb">https://colab.research.google.com/github/deepmind/mujoco/blob/main/python/tutorial.ipynb</a></p>
<p>å®˜æ–¹GitHub é“¾æ¥ä¸º <a target="_blank" rel="noopener" href="https://github.com/deepmind/mujoco#readme">https://github.com/deepmind/mujoco</a>.</p>
<h2 id="å®‰è£…-MuJoCo"><a href="#å®‰è£…-MuJoCo" class="headerlink" title="å®‰è£… MuJoCo"></a><strong>å®‰è£… MuJoCo</strong></h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install mujoco</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ"></a><strong>æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Check if installation was successful</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> files</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> distutils.util</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">if</span> subprocess.run(<span class="string">'nvidia-smi'</span>).returncode:</span><br><span class="line">  <span class="keyword">raise</span> RuntimeError(</span><br><span class="line">      <span class="string">'Cannot communicate with GPU. '</span></span><br><span class="line">      <span class="string">'Make sure you are using a GPU Colab runtime. '</span></span><br><span class="line">      <span class="string">'Go to the Runtime menu and select Choose runtime type.'</span>)</span><br><span class="line"><span class="comment"># Configure MuJoCo to use the EGL rendering backend (requires GPU)</span></span><br><span class="line"><span class="comment"># use WGL for Windows</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Setting environment variable to use GPU rendering:'</span>)</span><br><span class="line">%env MUJOCO_GL=egl</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Checking that the installation succeeded:'</span>)</span><br><span class="line">  <span class="keyword">import</span> mujoco</span><br><span class="line">  mujoco.MjModel.from_xml_string(<span class="string">'&lt;mujoco/&gt;'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">  <span class="keyword">raise</span> e <span class="keyword">from</span> RuntimeError(</span><br><span class="line">      <span class="string">'Something went wrong during installation. Check the shell output above '</span></span><br><span class="line">      <span class="string">'for more information.\n'</span></span><br><span class="line">      <span class="string">'If using a hosted Colab runtime, make sure you enable GPU acceleration '</span></span><br><span class="line">      <span class="string">'by going to the Runtime menu and selecting "Choose runtime type".'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Installation successful.'</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å¯¼å…¥ç›¸å…³å›¾å½¢å’Œç»˜å›¾åŒ…"><a href="#å¯¼å…¥ç›¸å…³å›¾å½¢å’Œç»˜å›¾åŒ…" class="headerlink" title="å¯¼å…¥ç›¸å…³å›¾å½¢å’Œç»˜å›¾åŒ…"></a><strong>å¯¼å…¥ç›¸å…³å›¾å½¢å’Œç»˜å›¾åŒ…</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Import packages for plotting and creating graphics</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, NamedTuple, <span class="type">Optional</span>, <span class="type">Union</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Graphics and plotting.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Installing mediapy:'</span>)</span><br><span class="line">!command -v ffmpeg &gt;/dev/null || (apt update &amp;&amp; apt install -y ffmpeg)</span><br><span class="line">!pip install -q mediapy</span><br><span class="line"><span class="keyword">import</span> mediapy <span class="keyword">as</span> media</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># More legible printing from numpy.</span></span><br><span class="line">np.set_printoptions(precision=<span class="number">3</span>, suppress=<span class="literal">True</span>, linewidth=<span class="number">100</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="MuJoCo-åŸºç¡€"><a href="#MuJoCo-åŸºç¡€" class="headerlink" title="MuJoCo åŸºç¡€"></a><strong>MuJoCo åŸºç¡€</strong></h2><p>æˆ‘ä»¬ä»å®šä¹‰ä¸è¯»å…¥ä¸€ä¸ªç®€å•çš„æ¨¡å‹æ¥å¼€å§‹:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xml = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(xml)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ®µ <code>xml</code> ä»£ç ä¾æ® MuJoCo çš„ <a target="_blank" rel="noopener" href="http://www.mujoco.org/book/modeling.html">MJCF</a> ç¼–å†™, è¿™æ˜¯ä¸€ç§åŸºäº <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/XML#Key_terminology">XML</a> çš„å»ºæ¨¡è¯­è¨€.</p>
<ul>
<li>å”¯ä¸€å¿…éœ€çš„å…ƒç´ ä¸º <code>&lt;mujoco&gt;</code>. æœ€å°çš„æœ‰æ•ˆ MJCF æ¨¡å‹ä¸º <code>&lt;mujoco/&gt;</code> , è¿™æ˜¯ä¸€ä¸ªå®Œå…¨ç©ºæ¨¡å‹.</li>
<li>æ‰€æœ‰çš„ç‰©ç†å…ƒç´ æ”¾åœ¨ <code>&lt;worldbody&gt;</code> ä¸­, è¿™å§‹ç»ˆä¸ºé¡¶å±‚ç‰©ä½“å¹¶æ„æˆç¬›å¡å°”åæ ‡ç³»çš„å…¨å±€åŸç‚¹.</li>
<li>æˆ‘ä»¬åœ¨ä¸–ç•Œä¸­å®šä¹‰ä¸¤ä¸ªå‡ ä½•ä½“ <code>red_box</code> å’Œ <code>green_sphere</code>.</li>
<li><strong>é—®é¢˜:</strong> <code>red_box</code> æ²¡æœ‰ä½ç½®, the <code>green_sphere</code> æ²¡æœ‰ç±»å‹, ä¸ºä»€ä¹ˆ?<ul>
<li><strong>ç­”:</strong> MJCF å±æ€§ä¸­æœ‰ <em>default values</em>. é»˜è®¤ä½ç½®ä¸º <code>0 0 0</code>, é»˜è®¤å‡ ä½•ç±»å‹ä¸º <code>sphere</code>. MJCF è¯­è¨€åœ¨æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://mujoco.readthedocs.io/en/latest/XMLreference.html">XML Reference chapter</a> ä¸­æœ‰ç›¸å…³è§£é‡Š.</li>
</ul>
</li>
</ul>
<p>æ–¹æ³• <code>from_xml_string()</code> è°ƒç”¨äº†æ¨¡å‹ç¼–è¯‘å™¨, å…¶åˆ›å»ºäº†ä¸€ä¸ªäºŒè¿›åˆ¶ <code>mjModel</code> å®ä¾‹.</p>
<h3 id="mjModel"><a href="#mjModel" class="headerlink" title="mjModel"></a><strong>mjModel</strong></h3><p>MuJoCo ä¸­çš„ <code>mjModel</code>, åŒ…å«äº†æ¨¡å‹æè¿°, æ¯”å¦‚æ‰€æœ‰å‡ä¸éšæ—¶é—´å˜åŒ–çš„é‡. <code>mjModel</code> çš„å®Œæ•´æè¿°å¯ä»¥åœ¨å¤´æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://github.com/deepmind/mujoco/blob/main/include/mujoco/mjmodel.h">mjmodel.h</a> çš„æœ«å°¾æ‰¾åˆ°. æ³¨æ„, å¤´æ–‡ä»¶åŒ…å«ç®€çŸ­çš„æœ‰ç”¨çš„è¡Œå†…æ³¨é‡Š, ç”¨äºæè¿°æ¯ä¸ªå­—æ®µ.</p>
<p>å¯ä»¥åœ¨æ¨¡å‹ <code>mjModel</code> æ‰¾åˆ°ä¸€äº›é‡, æ¯”å¦‚åœºæ™¯ä¸­çš„å‡ ä½•ä½“æ•°é‡<code>ngeom</code>,  ä»¥åŠå®ƒä»¬å„è‡ªçš„é¢œè‰² <code>geom_rgba</code>:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.ngeom</span><br><span class="line">model.geom_rgba</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>2</p>
<p>array([[1., 0., 0., 1.],<br>       [0., 1., 0., 1.]], dtype=float32)</p>
</blockquote>
<h3 id="Named-access"><a href="#Named-access" class="headerlink" title="Named access"></a><strong>Named access</strong></h3><p>MuJoCo Python çš„ç»‘å®šä½¿ç”¨åç§°æä¾›äº†ä¾¿æ·çš„è®¿é—®å™¨, åœ¨æ²¡æœ‰åç§°å­—ç¬¦ä¸²çš„æƒ…å†µä¸‹è°ƒç”¨ <code>model.geom()</code> è®¿é—®å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ–¹ä¾¿çš„é”™è¯¯æç¤º, å‘Šè¯‰æˆ‘ä»¬æœ‰æ•ˆçš„åç§°æ˜¯ä»€ä¹ˆ.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  model.geom()</span><br><span class="line"><span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</span><br><span class="line">  <span class="built_in">print</span>(e)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>"Invalid name". Valid names: ['green_sphere', 'red_box']</p>
</blockquote>
<p>è°ƒç”¨å‘½åè®¿é—®å™¨è€Œä¸æŒ‡å®šå±æ€§å°†å‘Šè¯‰æˆ‘ä»¬æ‰€æœ‰æœ‰æ•ˆçš„å±æ€§æ˜¯ä»€ä¹ˆ:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.geom(<span class="string">'green_sphere'</span>)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>&lt;_MjModelGeomViews<br>bodyid: array([0], dtype=int32)<br>conaffinity: array([1], dtype=int32)<br>condim: array([3], dtype=int32)<br>contype: array([1], dtype=int32)<br>dataid: array([-1], dtype=int32)<br>friction: array([1.   , 0.005, 0.   ])<br>gap: array([0.])<br>group: array([0], dtype=int32)<br>id: 1<br>margin: array([0.])<br>matid: array([-1], dtype=int32)<br>name: 'green_sphere'<br>pos: array([0.2, 0.2, 0.2])<br>priority: array([0], dtype=int32)<br>quat: array([1., 0., 0., 0.])<br>rbound: array([0.1])<br>rgba: array([0., 1., 0., 1.], dtype=float32)<br>sameframe: array([0], dtype=uint8)<br>size: array([0.1, 0. , 0. ])<br>solimp: array([0.9  , 0.95 , 0.001, 0.5  , 2.   ])<br>solmix: array([1.])<br>solref: array([0.02, 1.  ])<br>type: array([2], dtype=int32)<br>user: array([], dtype=float64)</p>
</blockquote>
<p>è®©æˆ‘ä»¬è·å– <code>green_sphere</code> çš„ rgba å€¼:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.geom(<span class="string">'green_sphere'</span>).rgba</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>array([0., 1., 0., 1.], dtype=float32)</p>
</blockquote>
<p>è¿™ä¸ªå‡½æ•°æ˜¯ MuJoCo çš„ <a target="_blank" rel="noopener" href="https://mujoco.readthedocs.io/en/latest/APIreference.html?highlight=mj_name2id#mj-name2id">mj_name2id</a> å‡½æ•°çš„ä¸€ä¸ªæ–¹ä¾¿çš„å¿«æ·æ–¹å¼:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_GEOM, <span class="string">'green_sphere'</span>)</span><br><span class="line">model.geom_rgba[<span class="built_in">id</span>, :]</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>array([0., 1., 0., 1.], dtype=float32)</p>
</blockquote>
<p>ç±»ä¼¼åœ°, åªè¯»çš„ <code>id</code> å’Œ<code>name</code> å±æ€§å¯ç”¨äºä» id è½¬æ¢åˆ° name ä»¥åŠåä¹‹:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'id of "green_sphere": '</span>, model.geom(<span class="string">'green_sphere'</span>).<span class="built_in">id</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'name of geom 1: '</span>, model.geom(<span class="number">1</span>).name)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'name of body 0: '</span>, model.body(<span class="number">0</span>).name)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>id of "green_sphere":  1<br>name of geom 1:  green_sphere<br>name of body 0:  world</p>
</blockquote>
<p>æ³¨æ„, ç¬¬ 0 ä¸ªç‰©ä½“æ€»æ˜¯ <code>world</code>. ä¸èƒ½é‡å‘½å.</p>
<p><code>id</code> å’Œ <code>name</code> å±æ€§åœ¨ Python æ¨å¯¼å¼ä¸­å¾ˆæœ‰ç”¨:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[model.geom(i).name <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(model.ngeom)]</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>['red_box', 'green_sphere']</p>
</blockquote>
<h3 id="mjData"><a href="#mjData" class="headerlink" title="mjData"></a><strong>mjData</strong></h3><p><code>mjData</code> åŒ…å«ä¾èµ–äºå®ƒçš„çŠ¶æ€å’Œæ•°é‡. çŠ¶æ€ç”±æ—¶é—´, å¹¿ä¹‰ä½ç½®å’Œå¹¿ä¹‰é€Ÿåº¦ç»„æˆ, åˆ†åˆ«ä¸º<code>data.time</code>, <code>data.qpos</code> å’Œ <code>data.qvel</code>. ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>mjData</code>ï¼Œæˆ‘ä»¬åªéœ€è¦ <code>mjModel</code>.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = mujoco.MjData(model)</span><br></pre></td></tr></tbody></table></figure>
<p><code>mjData</code> è¿˜åŒ…å«çŠ¶æ€å‡½æ•°, ä¾‹å¦‚ä¸–ç•Œåæ ‡ç³»ä¸­å¯¹è±¡çš„ç¬›å¡å°”ä½ç½®. ä¸¤ä¸ªå‡ ä½•ä½“çš„ (x, y, z) ä½ç½®åœ¨ <code>data.geom_xpos</code> ä¸­:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(data.geom_xpos)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>[[0. 0. 0.]<br> [0. 0. 0.]]</p>
</blockquote>
<p>ç­‰ç­‰, ä¸ºä»€ä¹ˆä¸¤ä¸ªå‡ ä½•ä½“éƒ½åœ¨åŸç‚¹? ç»¿è‰²çƒä½“ä¸æ˜¯æœ‰ä½ç§»å—? ç­”æ¡ˆæ˜¯ <code>mjData</code> ä¸­çš„æ´¾ç”Ÿé‡éœ€è¦æ˜¾å¼åœ°ä¼ æ’­(è§ä¸‹æ–‡). åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, æ‰€éœ€çš„æœ€å°å‡½æ•°æ˜¯ <a target="_blank" rel="noopener" href="https://mujoco.readthedocs.io/en/latest/APIreference.html#mj-kinematics">mj_kinematics</a>, å®ƒè®¡ç®—æ‰€æœ‰å¯¹è±¡(ä¸åŒ…æ‹¬ç›¸æœºå’Œç¯å…‰)çš„å…¨å±€ç¬›å¡å°”å§¿æ€.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mujoco.mj_kinematics(model, data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'raw access:\n'</span>, data.geom_xpos)</span><br><span class="line"></span><br><span class="line"><span class="comment"># MjData also supports named access:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'\nnamed access:\n'</span>, data.geom(<span class="string">'green_sphere'</span>).xpos)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>raw access:<br> [[0.  0.  0. ]<br> [0.2 0.2 0.2]]</p>
<p>named access:<br>[0.2 0.2 0.2]</p>
</blockquote>
<h2 id="åŸºæœ¬çš„æ¸²æŸ“ã€æ¨¡æ‹Ÿå’ŒåŠ¨ç”»"><a href="#åŸºæœ¬çš„æ¸²æŸ“ã€æ¨¡æ‹Ÿå’ŒåŠ¨ç”»" class="headerlink" title="åŸºæœ¬çš„æ¸²æŸ“ã€æ¨¡æ‹Ÿå’ŒåŠ¨ç”»"></a><strong>åŸºæœ¬çš„æ¸²æŸ“ã€æ¨¡æ‹Ÿå’ŒåŠ¨ç”»</strong></h2><p>è¦å®ç°æ¸²æŸ“, æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª <code>Renderer</code> å¯¹è±¡å¹¶è°ƒç”¨å®ƒçš„ <code>render</code> æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">xml = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># Make model and data</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(xml)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make renderer, render and show the pixels</span></span><br><span class="line">renderer = mujoco.Renderer(model)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/0.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/0.png" class="" title="black"></a></div>

<p>å—¯â€¦ ä¸ºä»€ä¹ˆæ˜¯é»‘è‰²åƒç´ ?</p>
<p><strong>ç­”</strong>: å‡ºäºä¸ä¸Šé¢ç›¸åŒçš„åŸå› , æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¼ æ’­ <code>mjData</code> ä¸­çš„å€¼. è¿™æ¬¡æˆ‘ä»¬å°†è°ƒç”¨ <a target="_blank" rel="noopener" href="https://mujoco.readthedocs.io/en/latest/APIreference.html#mj-forward">mj_forward</a>, å®ƒå°†è°ƒç”¨æ•´ä¸ªç®¡çº¿, ç›´åˆ°è®¡ç®—åŠ é€Ÿåº¦, å³, å®ƒè®¡ç®— <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.61ex" height="2.301ex" role="img" focusable="false" viewBox="0 -767 3805.6 1017"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mover"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(313.8,-2) translate(-250 0)"><path data-c="2D9" d="M190 609Q190 637 208 653T252 669Q275 667 292 652T309 609Q309 579 292 564T250 549Q225 549 208 564T190 609Z"></path></g></g></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(1905.6,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(2455.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2844.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(3416.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>, å…¶ä¸­ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 572 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g></svg></mjx-container> æ˜¯çŠ¶æ€. è¿™ä¸ªå‡½æ•°æ‰€åšçš„æ¯”æˆ‘ä»¬å®é™…éœ€è¦çš„è¦å¤š, ä½†æ˜¯é™¤éæˆ‘ä»¬å…³å¿ƒèŠ‚çœè®¡ç®—æ—¶é—´, å¦åˆ™è°ƒç”¨ <code>mj_forward</code> æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µ, å› ä¸ºè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“æˆ‘ä»¬ä¸ä¼šé—æ¼ä»»ä½•ä¸œè¥¿.</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦æ›´æ–° <code>mjvScene</code>, è¿™æ˜¯ä¸€ä¸ªç”±æ¸²æŸ“å™¨æŒæœ‰çš„æè¿°å¯è§†åŒ–åœºæ™¯çš„å¯¹è±¡. æˆ‘ä»¬ç¨åå°†çœ‹åˆ°åœºæ™¯å¯ä»¥åŒ…æ‹¬ä¸å±äºç‰©ç†æ¨¡å‹çš„å¯è§†åŒ–å¯¹è±¡.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data)</span><br><span class="line"></span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/1.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/1.png" class="" title="dark"></a></div>

<p>è¿™æ˜¯æœ‰æ•ˆçš„, ä½†è¿™å¼ ç…§ç‰‡æœ‰ç‚¹æš—. è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç¯å…‰å¹¶é‡æ–°æ¸²æŸ“.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xml = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="top" pos="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(xml)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">renderer = mujoco.Renderer(model)</span><br><span class="line"></span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data)</span><br><span class="line"></span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/2.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/2.png" class="" title="light"></a></div>

<p>å¥½å¤šäº†!</p>
<p>æ³¨æ„, <code>mjModel</code> å®ä¾‹ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯å¯å†™å…¥çš„. è™½ç„¶é€šå¸¸ä¸å»ºè®®è¿™æ ·åš, è€Œæ˜¯å»ºè®®æ›´æ”¹ <strong>XML</strong> ä¸­çš„å€¼, å› ä¸ºå¾ˆå®¹æ˜“åˆ›å»ºæ— æ•ˆçš„æ¨¡å‹, ä½†æœ‰äº›å€¼æ˜¯å¯ä»¥å®‰å…¨å†™å…¥çš„, ä¾‹å¦‚é¢œè‰²:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run this cell multiple times for different colors</span></span><br><span class="line">model.geom(<span class="string">'red_box'</span>).rgba[:<span class="number">3</span>] = np.random.rand(<span class="number">3</span>)</span><br><span class="line">renderer.update_scene(data)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/3.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/3.png" class="" title="color"></a></div>

<h2 id="ä»¿çœŸ"><a href="#ä»¿çœŸ" class="headerlink" title="ä»¿çœŸ"></a><strong>ä»¿çœŸ</strong></h2><p>ç°åœ¨è¿›è¡Œä»¿çœŸå¹¶åˆ¶ä½œä¸€ä¸ªè§†é¢‘. æˆ‘ä»¬å°†ä½¿ç”¨ MuJoCo çš„ä¸»è¦é«˜çº§å‡½æ•° <code>mj_step</code>, è¯¥å‡½æ•°æ¯æ­¥æ›´æ–°çŠ¶æ€ <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="12.307ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 5439.5 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="TeXAtom" transform="translate(605,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(361,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1139,0)"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2145.5,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3201.2,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(3751.2,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(4140.2,0)"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g><g data-mml-node="mo" transform="translate(5050.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>.</p>
<p>æ³¨æ„, åœ¨ä¸‹é¢çš„ä»£ç å—ä¸­, æˆ‘ä»¬ä¸ä¼šåœ¨æ¯æ¬¡è°ƒç”¨ <code>mj_step</code> åè¿›è¡Œæ¸²æŸ“. è¿™æ˜¯å› ä¸ºé»˜è®¤çš„æ—¶é—´æ­¥é•¿æ˜¯ 2ms, æˆ‘ä»¬æƒ³è¦ä¸€ä¸ª 60fps çš„è§†é¢‘, è€Œä¸æ˜¯ 500fps.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">duration = <span class="number">3.8</span>  <span class="comment"># (seconds)</span></span><br><span class="line">framerate = <span class="number">60</span>  <span class="comment"># (Hz)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and display video.</span></span><br><span class="line">frames = []</span><br><span class="line">mujoco.mj_resetData(model, data)  <span class="comment"># Reset state and time.</span></span><br><span class="line"><span class="keyword">while</span> data.time &lt; duration:</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; data.time * framerate:</span><br><span class="line">    renderer.update_scene(data)</span><br><span class="line">    pixels = renderer.render()</span><br><span class="line">    frames.append(pixels)</span><br><span class="line">media.show_video(frames, fps=framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="static.mp4" type="video/mp4">
</video>


<p>å—¯â€¦ è§†é¢‘åœ¨æ’­æ”¾, ä½†æ˜¯æ²¡æœ‰ä¸œè¥¿åœ¨åŠ¨, ä¸ºä»€ä¹ˆå‘¢?</p>
<p>è¿™æ˜¯å› ä¸ºè¿™ä¸ªæ¨¡å‹æ²¡æœ‰<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Degrees_of_freedom_(mechanics">è‡ªç”±åº¦</a>)(DoFs). è¿åŠ¨çš„(æœ‰æƒ¯æ€§çš„)ç‰©ä½“å«åš bodies. æˆ‘ä»¬é€šè¿‡ç»™ bodies æ·»åŠ  joints æ¥æ·»åŠ  DoFs, æŒ‡å®šå®ƒä»¬å¦‚ä½•ç›¸å¯¹äº parents ç§»åŠ¨. è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«å‡ ä½•ä½“çš„æ–° body, æ·»åŠ ä¸€ä¸ªé“°é“¾å…³èŠ‚å¹¶é‡æ–°æ¸²æŸ“, åŒæ—¶ä½¿ç”¨å¯è§†åŒ–é€‰é¡¹å¯¹è±¡ <code>MjvOption</code> æ¥å¯è§†åŒ–å…³èŠ‚è½´ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">xml = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="top" pos="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="box_and_sphere" euler="0 0 -30"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint name="swing" type="hinge" axis="1 -1 0" pos="-.2 -.2 -.2"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(xml)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">renderer = mujoco.Renderer(model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable joint visualization option:</span></span><br><span class="line">scene_option = mujoco.MjvOption()</span><br><span class="line">scene_option.flags[mujoco.mjtVisFlag.mjVIS_JOINT] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">duration = <span class="number">3.8</span>  <span class="comment"># (seconds)</span></span><br><span class="line">framerate = <span class="number">60</span>  <span class="comment"># (Hz)</span></span><br><span class="line"></span><br><span class="line">frames = []</span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line"><span class="keyword">while</span> data.time &lt; duration:</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; data.time * framerate:</span><br><span class="line">    renderer.update_scene(data, scene_option=scene_option)</span><br><span class="line">    pixels = renderer.render()</span><br><span class="line">    frames.append(pixels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and display video.</span></span><br><span class="line">media.show_video(frames, fps=framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="rolling.mp4" type="video/mp4">
</video>


<p>æ³¨æ„, æˆ‘ä»¬å°† <code>box_and_sphere</code> body ç»• Z (å‚ç›´)è½´æ—‹è½¬30Â°, æŒ‡ä»¤ <code>euler="0 0 -30"</code>. è¿™æ ·åšæ˜¯ä¸ºäº†å¼ºè°ƒ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kinematic_chain">è¿åŠ¨æ ‘</a>ä¸­å…ƒç´ çš„å§¿æ€æ€»æ˜¯ç›¸å¯¹äºå®ƒä»¬çš„çˆ¶ä½“, æ‰€ä»¥æˆ‘ä»¬çš„ä¸¤ä¸ªå‡ ä½•ä½“ä¹Ÿé€šè¿‡è¿™ä¸ªå˜æ¢æ—‹è½¬.</p>
<p>ç‰©ç†é€‰é¡¹ä½äº <code>mjModel.opt</code> ä¸­, ä¾‹å¦‚æ—¶é—´æ­¥:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.opt.timestep</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>0.002</p>
</blockquote>
<p>è®©æˆ‘ä»¬ç¿»è½¬é‡åŠ›å¹¶é‡æ–°æ¸²æŸ“:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'default gravity'</span>, model.opt.gravity)</span><br><span class="line">model.opt.gravity = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'flipped gravity'</span>, model.opt.gravity)</span><br><span class="line"></span><br><span class="line">frames = []</span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line"><span class="keyword">while</span> data.time &lt; duration:</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; data.time * framerate:</span><br><span class="line">    renderer.update_scene(data, scene_option=scene_option)</span><br><span class="line">    pixels = renderer.render()</span><br><span class="line">    frames.append(pixels)</span><br><span class="line"></span><br><span class="line">media.show_video(frames, fps=<span class="number">60</span>)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>default gravity [ 0.    0.   -9.81]<br>flipped gravity [ 0.  0. 10.]</p>
</blockquote>
<video controls="">
     <source src="flipG.mp4" type="video/mp4">
</video>


<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ XML ä¸­ä½¿ç”¨é¡¶çº§å…ƒç´  <code>&lt;option&gt;</code> æ¥å®ç°å®ƒ:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mujoco</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">gravity</span>=<span class="string">"0 0 10"</span>/&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">mujoco</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ç†è§£è‡ªç”±åº¦"><a href="#ç†è§£è‡ªç”±åº¦" class="headerlink" title="ç†è§£è‡ªç”±åº¦"></a><strong>ç†è§£è‡ªç”±åº¦</strong></h3><p>åœ¨ç°å®ä¸–ç•Œä¸­, æ‰€æœ‰åˆšä½“éƒ½æœ‰ 6 ä¸ªè‡ªç”±åº¦: 3 ä¸ªå¹³ç§»å’Œ 3 ä¸ªæ—‹è½¬. ç°å®ä¸–ç•Œä¸­çš„å…³èŠ‚å……å½“çº¦æŸ, æ¶ˆé™¤äº†ç”±å…³èŠ‚è¿æ¥çš„ç‰©ä½“çš„ç›¸å¯¹è‡ªç”±åº¦. ä¸€äº›ç‰©ç†æ¨¡æ‹Ÿè½¯ä»¶ä½¿ç”¨è¿™ç§è¢«ç§°ä¸º â€œCartesianâ€ æˆ– â€œsubtractiveâ€ çš„è¡¨ç¤ºæ³•, ä½†å®ƒçš„æ•ˆç‡å¾ˆä½. MuJoCo ä½¿ç”¨ä¸€ç§è¢«ç§°ä¸º â€œLagrangianâ€, â€œgeneralizedâ€ æˆ– â€œadditiveâ€ çš„è¡¨ç¤º, å…¶ä¸­å¯¹è±¡æ²¡æœ‰è‡ªç”±åº¦, é™¤éä½¿ç”¨å…³èŠ‚æ˜¾å¼åœ°æ·»åŠ .</p>
<p>æˆ‘ä»¬çš„æ¨¡å‹æœ‰ä¸€ä¸ªé“°é“¾å…³èŠ‚, æœ‰ä¸€ä¸ªè‡ªç”±åº¦, æ•´ä¸ªçŠ¶æ€ç”±è¿™ä¸ªå…³èŠ‚çš„è§’åº¦å’Œè§’é€Ÿåº¦å®šä¹‰. è¿™æ˜¯ç³»ç»Ÿçš„å¹¿ä¹‰ä½ç½®å’Œé€Ÿåº¦.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'Total number of DoFs in the model:'</span>, model.nv)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Generalized positions:'</span>, data.qpos)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Generalized velocities:'</span>, data.qvel)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Total number of DoFs in the model: 1<br>Generalized positions: [1.392]<br>Generalized velocities: [-3.79]</p>
</blockquote>
<p>MuJoCo ä½¿ç”¨å¹¿ä¹‰åæ ‡çš„åŸå› æ˜¯åœ¨æ¸²æŸ“æˆ–è¯»å–å¯¹è±¡çš„å…¨å±€ä½ç½®ä¹‹å‰éœ€è¦è°ƒç”¨å‡½æ•°(ä¾‹å¦‚ <a target="_blank" rel="noopener" href="https://mujoco.readthedocs.io/en/latest/APIreference.html#mj-forward">mj_forward</a>) - ç¬›å¡å°”ä½ç½®æ˜¯ä»å¹¿ä¹‰ä½ç½®æ´¾ç”Ÿå‡ºæ¥çš„, éœ€è¦æ˜¾å¼è®¡ç®—.</p>
<h2 id="ç¤ºä¾‹-ç”¨è‡ªåè½¬çš„â€œtippe-topâ€æ¨¡æ‹Ÿè‡ªç”±ä½“"><a href="#ç¤ºä¾‹-ç”¨è‡ªåè½¬çš„â€œtippe-topâ€æ¨¡æ‹Ÿè‡ªç”±ä½“" class="headerlink" title="ç¤ºä¾‹: ç”¨è‡ªåè½¬çš„â€œtippe-topâ€æ¨¡æ‹Ÿè‡ªç”±ä½“"></a><strong>ç¤ºä¾‹: ç”¨è‡ªåè½¬çš„â€œtippe-topâ€æ¨¡æ‹Ÿè‡ªç”±ä½“</strong></h2><p>ä¸€ä¸ªè‡ªç”±ç‰©ä½“æ˜¯ä¸€ä¸ªå…·æœ‰ 6 ä¸ªè‡ªç”±åº¦çš„<a target="_blank" rel="noopener" href="https://mujoco.readthedocs.io/en/latest/XMLreference.html?highlight=freejoint#body-freejoint">è‡ªç”±å…³èŠ‚</a>çš„ç‰©ä½“, å³ 3 ä¸ªå¹³ç§»å’Œ 3 ä¸ªæ—‹è½¬. æˆ‘ä»¬å…¶å®å¯ä»¥ç»™ <code>box_and_sphere</code> ä½“ä¸€ä¸ªè‡ªç”±å…³èŠ‚, ç„¶åçœ‹ç€å®ƒä¸‹è½ï¼Œä½†æ˜¯è®©æˆ‘ä»¬çœ‹ä¸€äº›æ›´æœ‰è¶£çš„ä¸œè¥¿. ä¸€ä¸ª â€œtippe topâ€ æ˜¯ä¸€ä¸ªæ—‹è½¬çš„ç©å…·, å®ƒå¯ä»¥è‡ªå·±ç¿»è½¬(<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kbYpVrdcszQ">è§†é¢‘</a>ï¼Œ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Tippe_top">ç»´åŸºç™¾ç§‘</a>). æˆ‘ä»¬å°†å…¶å»ºæ¨¡å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">tippe_top = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco model="tippe top"&gt;</span></span><br><span class="line"><span class="string">  &lt;option integrator="RK4"/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;asset&gt;</span></span><br><span class="line"><span class="string">    &lt;texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3"</span></span><br><span class="line"><span class="string">     rgb2=".2 .3 .4" width="300" height="300"/&gt;</span></span><br><span class="line"><span class="string">    &lt;material name="grid" texture="grid" texrepeat="8 8" reflectance=".2"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/asset&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;geom size=".2 .2 .01" type="plane" material="grid"/&gt;</span></span><br><span class="line"><span class="string">    &lt;light pos="0 0 .6"/&gt;</span></span><br><span class="line"><span class="string">    &lt;camera name="closeup" pos="0 -.1 .07" xyaxes="1 0 0 0 1 2"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="top" pos="0 0 .02"&gt;</span></span><br><span class="line"><span class="string">      &lt;freejoint/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="ball" type="sphere" size=".02" /&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="stem" type="cylinder" pos="0 0 .02" size="0.004 .008"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="ballast" type="box" size=".023 .023 0.005"  pos="0 0 -.015"</span></span><br><span class="line"><span class="string">       contype="0" conaffinity="0" group="3"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;keyframe&gt;</span></span><br><span class="line"><span class="string">    &lt;key name="spinning" qpos="0 0 0.02 1 0 0 0" qvel="0 0 0 0 1 200" /&gt;</span></span><br><span class="line"><span class="string">  &lt;/keyframe&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(tippe_top)</span><br><span class="line">renderer = mujoco.Renderer(model)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data, camera=<span class="string">"closeup"</span>)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/4.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/4.png" class="" title="tippe-top"></a></div>

<p>æ³¨æ„è¿™ä¸ªæ¨¡å‹å®šä¹‰çš„å‡ ä¸ªæ–°ç‰¹æ€§:</p>
<ol>
<li>ä¸€ä¸ªä½¿ç”¨ <code>&lt;freejoint/&gt;</code> æ ‡ç­¾æ·»åŠ çš„6è‡ªç”±åº¦è‡ªç”±å…³èŠ‚.</li>
<li>æˆ‘ä»¬ä½¿ç”¨ <code>&lt;option/&gt;</code> æ ‡ç­¾å°†ç§¯åˆ†å™¨è®¾ç½®ä¸º 4 é˜¶ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge Kutta</a>. Runge-Kutta å…·æœ‰æ¯”é»˜è®¤çš„æ¬§æ‹‰ç§¯åˆ†å™¨æ›´é«˜çš„æ”¶æ•›é€Ÿç‡, åœ¨è®¸å¤šæƒ…å†µä¸‹, åœ¨ç»™å®šçš„æ—¶é—´æ­¥é•¿ä¸‹æé«˜äº†ç²¾åº¦.</li>
<li>æˆ‘ä»¬åœ¨ <code>&lt;asset/&gt;</code> æ ‡ç­¾ä¸­å®šä¹‰åœ°æ¿çš„ç½‘æ ¼æè´¨, å¹¶åœ¨ "floorâ€ å‡ ä½•ä½“ä¸­å¼•ç”¨å®ƒ.</li>
<li>æˆ‘ä»¬ä½¿ç”¨ä¸€ç§çœ‹ä¸è§çš„, ä¸ç¢°æ’çš„ box å‡ ä½•ä½“, ç§°ä¸º ballast , æ¥é™ä½é¡¶éƒ¨çš„è´¨å¿ƒ. ä½è´¨å¿ƒæ˜¯å‘ç”Ÿç¿»è½¬è¡Œä¸ºæ‰€å¿…éœ€çš„(ä¸ç›´è§‰ç›¸å).</li>
<li>æˆ‘ä»¬å°†åˆå§‹æ—‹è½¬çŠ¶æ€ä¿å­˜ä¸ºå…³é”®å¸§. å®ƒç»•Zè½´æœ‰å¾ˆé«˜çš„æ—‹è½¬é€Ÿåº¦, ä½†å¹¶ä¸å®Œå…¨æœå‘ä¸–ç•Œåæ ‡è½´, è¿™å¼•å…¥äº†ç¿»è½¬æ‰€éœ€çš„å¯¹ç§°æ€§ç ´å.</li>
<li>æˆ‘ä»¬åœ¨æ¨¡å‹ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>&lt;camera&gt;</code>, ç„¶åä½¿ç”¨ <code>&lt;camera&gt;</code> å‚æ•°å¯¹ <code>update_scene()</code> è¿›è¡Œæ¸²æŸ“. è®©æˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹ç°åœ¨çš„çŠ¶æ€:</li>
</ol>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'positions'</span>, data.qpos)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'velocities'</span>, data.qvel)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>positions [0.   0.   0.02 1.   0.   0.   0.  ]<br>velocities [0. 0. 0. 0. 0. 0.]</p>
</blockquote>
<p>é€Ÿåº¦å¾ˆå®¹æ˜“è§£é‡Š, 6 ä¸ª 0, æ¯ä¸ªè‡ªç”±åº¦ä¸€ä¸ª. é‚£ä¹ˆé•¿åº¦ä¸º 7 çš„ä½ç½®å‘¢? æˆ‘ä»¬å¯ä»¥çœ‹åˆ° body æœ€åˆçš„ 2 å˜ç±³é«˜åº¦; åé¢çš„ 4 ä¸ªæ•°å­—æ˜¯ä¸‰ç»´æœå‘, ç”±å•ä½å››å…ƒæ•°å®šä¹‰. ä¸‰ç»´æœå‘ç”¨ 4 ä¸ªæ•°å­—è¡¨ç¤º, è§’é€Ÿåº¦ç”¨ 3 ä¸ªæ•°å­—è¡¨ç¤º. æœ‰å…³æ›´å¤šä¿¡æ¯, è¯·å‚é˜…ç»´åŸºç™¾ç§‘å…³äº<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation">å››å…ƒæ•°å’Œç©ºé—´æ—‹è½¬</a>çš„æ–‡ç« .</p>
<p>è®©æˆ‘ä»¬åšä¸€ä¸ªè§†é¢‘:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">duration = <span class="number">7</span>    <span class="comment"># (seconds)</span></span><br><span class="line">framerate = <span class="number">60</span>  <span class="comment"># (Hz)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and display video.</span></span><br><span class="line">frames = []</span><br><span class="line">mujoco.mj_resetDataKeyframe(model, data, <span class="number">0</span>)  <span class="comment"># Reset the state to keyframe 0</span></span><br><span class="line"><span class="keyword">while</span> data.time &lt; duration:</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; data.time * framerate:</span><br><span class="line">    renderer.update_scene(data, <span class="string">"closeup"</span>)</span><br><span class="line">    pixels = renderer.render()</span><br><span class="line">    frames.append(pixels)</span><br><span class="line"></span><br><span class="line">media.show_video(frames, fps=framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="tippe-top.mp4" type="video/mp4">
</video>


<h3 id="æµ‹é‡-mjData-ä¸­çš„å€¼"><a href="#æµ‹é‡-mjData-ä¸­çš„å€¼" class="headerlink" title="æµ‹é‡ mjData ä¸­çš„å€¼"></a><strong>æµ‹é‡ <code>mjData</code> ä¸­çš„å€¼</strong></h3><p>å¦‚ä¸Šæ‰€è¿°, <code>mjData</code> ç»“æ„åŒ…å«ç”±æ¨¡æ‹Ÿäº§ç”Ÿçš„åŠ¨æ€å˜é‡å’Œä¸­é—´ç»“æœ, è¿™äº›ç»“æœé¢„è®¡ä¼šåœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¸Šå‘ç”Ÿå˜åŒ–. ä¸‹é¢æˆ‘ä»¬æ¨¡æ‹Ÿäº† 2000 ä¸ªæ—¶é—´æ­¥é•¿, å¹¶ç»˜åˆ¶äº†æ†é¡¶çš„è§’é€Ÿåº¦å’Œé«˜åº¦ä½œä¸ºæ—¶é—´çš„å‡½æ•°.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">timevals = []</span><br><span class="line">angular_velocity = []</span><br><span class="line">stem_height = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and save data</span></span><br><span class="line">mujoco.mj_resetDataKeyframe(model, data, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> data.time &lt; duration:</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  timevals.append(data.time)</span><br><span class="line">  angular_velocity.append(data.qvel[<span class="number">3</span>:<span class="number">6</span>].copy())</span><br><span class="line">  stem_height.append(data.geom_xpos[<span class="number">2</span>,<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">dpi = <span class="number">120</span></span><br><span class="line">width = <span class="number">600</span></span><br><span class="line">height = <span class="number">800</span></span><br><span class="line">figsize = (width / dpi, height / dpi)</span><br><span class="line">_, ax = plt.subplots(<span class="number">2</span>, <span class="number">1</span>, figsize=figsize, dpi=dpi, sharex=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].plot(timevals, angular_velocity)</span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">'angular velocity'</span>)</span><br><span class="line">ax[<span class="number">0</span>].set_ylabel(<span class="string">'radians / second'</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">1</span>].plot(timevals, stem_height)</span><br><span class="line">ax[<span class="number">1</span>].set_xlabel(<span class="string">'time (seconds)'</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_ylabel(<span class="string">'meters'</span>)</span><br><span class="line">_ = ax[<span class="number">1</span>].set_title(<span class="string">'stem height'</span>)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/5.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/5.png" class="" title="mjData"></a></div>

<h2 id="å®ä¾‹-ä¸€ä¸ªæ··æ²Œæ‘†"><a href="#å®ä¾‹-ä¸€ä¸ªæ··æ²Œæ‘†" class="headerlink" title="å®ä¾‹: ä¸€ä¸ªæ··æ²Œæ‘†"></a><strong>å®ä¾‹: ä¸€ä¸ªæ··æ²Œæ‘†</strong></h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ··æ²Œæ‘†æ¨¡å‹, ä¸æ—§é‡‘å±±æ¢ç´¢åšç‰©é¦†çš„<a target="_blank" rel="noopener" href="https://www.exploratorium.edu/exhibits/chaotic-pendulum">è¿™ä¸ª</a>æ¨¡å‹ç›¸ä¼¼.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">chaotic_pendulum = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;option timestep=".001"&gt;</span></span><br><span class="line"><span class="string">    &lt;flag energy="enable" contact="disable"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/option&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;default&gt;</span></span><br><span class="line"><span class="string">    &lt;joint type="hinge" axis="0 -1 0"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom type="capsule" size=".02"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/default&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light pos="0 -.4 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;camera name="fixed" pos="0 -1 0" xyaxes="1 0 0 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="0" pos="0 0 .2"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint name="root"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom fromto="-.2 0 0 .2 0 0" rgba="1 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom fromto="0 0 0 0 0 -.25" rgba="1 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;body name="1" pos="-.2 0 0"&gt;</span></span><br><span class="line"><span class="string">        &lt;joint/&gt;</span></span><br><span class="line"><span class="string">        &lt;geom fromto="0 0 0 0 0 -.2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">      &lt;body name="2" pos=".2 0 0"&gt;</span></span><br><span class="line"><span class="string">        &lt;joint/&gt;</span></span><br><span class="line"><span class="string">        &lt;geom fromto="0 0 0 0 0 -.2" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">      &lt;body name="3" pos="0 0 -.25"&gt;</span></span><br><span class="line"><span class="string">        &lt;joint/&gt;</span></span><br><span class="line"><span class="string">        &lt;geom fromto="0 0 0 0 0 -.2" rgba="0 0 1 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(chaotic_pendulum)</span><br><span class="line">renderer = mujoco.Renderer(model, <span class="number">480</span>, <span class="number">640</span>)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data, camera=<span class="string">"fixed"</span>)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/6.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/6.png" class="" title="chaotic"></a></div>

<h3 id="Timing"><a href="#Timing" class="headerlink" title="Timing"></a><strong>Timing</strong></h3><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåœ¨è¿è¡Œæ—¶çš„è§†é¢‘, åŒæ—¶æˆ‘ä»¬å¯¹ç»„ä»¶è¿›è¡Œè®¡æ—¶:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setup</span></span><br><span class="line">n_seconds = <span class="number">6</span></span><br><span class="line">framerate = <span class="number">30</span>  <span class="comment"># Hz</span></span><br><span class="line">n_frames = <span class="built_in">int</span>(n_seconds * framerate)</span><br><span class="line">frames = []</span><br><span class="line">renderer = mujoco.Renderer(model, <span class="number">240</span>, <span class="number">320</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set initial state</span></span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line">data.joint(<span class="string">'root'</span>).qvel = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate and record frames</span></span><br><span class="line">frame = <span class="number">0</span></span><br><span class="line">sim_time = <span class="number">0</span></span><br><span class="line">render_time = <span class="number">0</span></span><br><span class="line">n_steps = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_frames):</span><br><span class="line">  <span class="keyword">while</span> data.time * framerate &lt; i:</span><br><span class="line">    tic = time.time()</span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">    sim_time += time.time() - tic</span><br><span class="line">    n_steps += <span class="number">1</span></span><br><span class="line">  tic = time.time()</span><br><span class="line">  renderer.update_scene(data, <span class="string">"fixed"</span>)</span><br><span class="line">  frame = renderer.render()</span><br><span class="line">  render_time += time.time() - tic</span><br><span class="line">  frames.append(frame)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print timing and play video</span></span><br><span class="line">step_time = <span class="number">1e6</span>*sim_time/n_steps</span><br><span class="line">step_fps = n_steps/sim_time</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'simulation: <span class="subst">{step_time:<span class="number">5.3</span>g}</span> Î¼s/step  (<span class="subst">{step_fps:<span class="number">5.0</span>f}</span>Hz)'</span>)</span><br><span class="line">frame_time = <span class="number">1e6</span>*render_time/n_frames</span><br><span class="line">frame_fps = n_frames/render_time</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'rendering:  <span class="subst">{frame_time:<span class="number">5.3</span>g}</span> Î¼s/frame (<span class="subst">{frame_fps:<span class="number">5.0</span>f}</span>Hz)'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># show video</span></span><br><span class="line">media.show_video(frames, fps=framerate)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>simulation:  3.74 Î¼s/step  (267581Hz)<br>rendering:  3.31e+04 Î¼s/frame (   30Hz)</p>
</blockquote>
<video controls="">
     <source src="chaotic.mp4" type="video/mp4">
</video>


<p>æ³¨æ„, æ¸²æŸ“æ¯”æ¨¡æ‹Ÿç‰©ç†è¦æ…¢å¾—å¤š.</p>
<h3 id="Chaos"><a href="#Chaos" class="headerlink" title="Chaos"></a><strong>Chaos</strong></h3><p>è¿™æ˜¯ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Chaos_theory">æ··æ²Œ</a>ç³»ç»Ÿ(åˆå§‹æ¡ä»¶ä¸‹çš„å°æ‰°åŠ¨ä¼šè¿…é€Ÿç´¯ç§¯):</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PERTURBATION = <span class="number">1e-7</span></span><br><span class="line">SIM_DURATION = <span class="number">10</span> <span class="comment"># seconds</span></span><br><span class="line">NUM_REPEATS = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># preallocate</span></span><br><span class="line">n_steps = <span class="built_in">int</span>(SIM_DURATION / model.opt.timestep)</span><br><span class="line">sim_time = np.zeros(n_steps)</span><br><span class="line">angle = np.zeros(n_steps)</span><br><span class="line">energy = np.zeros(n_steps)</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare plotting axes</span></span><br><span class="line">_, ax = plt.subplots(<span class="number">2</span>, <span class="number">1</span>, figsize=(<span class="number">8</span>, <span class="number">6</span>), sharex=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate NUM_REPEATS times with slightly different initial conditions</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(NUM_REPEATS):</span><br><span class="line">  <span class="comment"># initialize</span></span><br><span class="line">  mujoco.mj_resetData(model, data)</span><br><span class="line">  data.qvel[<span class="number">0</span>] = <span class="number">10</span> <span class="comment"># root joint velocity</span></span><br><span class="line">  <span class="comment"># perturb initial velocities</span></span><br><span class="line">  data.qvel[:] += PERTURBATION * np.random.randn(model.nv)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># simulate</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_steps):</span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">    sim_time[i] = data.time</span><br><span class="line">    angle[i] = data.joint(<span class="string">'root'</span>).qpos</span><br><span class="line">    energy[i] = data.energy[<span class="number">0</span>] + data.energy[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># plot</span></span><br><span class="line">  ax[<span class="number">0</span>].plot(sim_time, angle)</span><br><span class="line">  ax[<span class="number">1</span>].plot(sim_time, energy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># finalize plot</span></span><br><span class="line">ax[<span class="number">0</span>].set_title(<span class="string">'root angle'</span>)</span><br><span class="line">ax[<span class="number">0</span>].set_ylabel(<span class="string">'radian'</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_title(<span class="string">'total energy'</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_ylabel(<span class="string">'Joule'</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_xlabel(<span class="string">'second'</span>)</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:70%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/7.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/7.png" class="" title="chaos"></a></div>

<h3 id="æ—¶é—´æ­¥é•¿å’Œç²¾åº¦"><a href="#æ—¶é—´æ­¥é•¿å’Œç²¾åº¦" class="headerlink" title="æ—¶é—´æ­¥é•¿å’Œç²¾åº¦"></a><strong>æ—¶é—´æ­¥é•¿å’Œç²¾åº¦</strong></h3><p><strong>é—®é¢˜:</strong> ä¸ºä»€ä¹ˆèƒ½é‡ä¼šå‘ç”Ÿå˜åŒ–? æ²¡æœ‰æ‘©æ“¦å’Œé˜»å°¼, è¿™ä¸ªç³»ç»Ÿåº”è¯¥èŠ‚çœèƒ½é‡.</p>
<p><strong>ç­”:</strong> å› ä¸ºæ—¶é—´çš„ç¦»æ•£åŒ–.</p>
<p>å¦‚æœæˆ‘ä»¬å‡å°‘æ—¶é—´æ­¥é•¿, æˆ‘ä»¬å°†è·å¾—æ›´å¥½çš„ç²¾åº¦å’Œæ›´å¥½çš„èŠ‚èƒ½:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">SIM_DURATION = <span class="number">10</span> <span class="comment"># (seconds)</span></span><br><span class="line">TIMESTEPS = np.power(<span class="number">10</span>, np.linspace(-<span class="number">2</span>, -<span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare plotting axes</span></span><br><span class="line">_, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dt <span class="keyword">in</span> TIMESTEPS:</span><br><span class="line">   <span class="comment"># set timestep, print</span></span><br><span class="line">  model.opt.timestep = dt</span><br><span class="line"></span><br><span class="line">  <span class="comment"># allocate</span></span><br><span class="line">  n_steps = <span class="built_in">int</span>(SIM_DURATION / model.opt.timestep)</span><br><span class="line">  sim_time = np.zeros(n_steps)</span><br><span class="line">  energy = np.zeros(n_steps)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># initialize</span></span><br><span class="line">  mujoco.mj_resetData(model, data)</span><br><span class="line">  data.qvel[<span class="number">0</span>] = <span class="number">9</span> <span class="comment"># root joint velocity</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># simulate</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'{} steps at dt = {:2.2g}ms'</span>.<span class="built_in">format</span>(n_steps, <span class="number">1000</span>*dt))</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_steps):</span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">    sim_time[i] = data.time</span><br><span class="line">    energy[i] = data.energy[<span class="number">0</span>] + data.energy[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># plot</span></span><br><span class="line">  ax.plot(sim_time, energy, label=<span class="string">'timestep = {:2.2g}ms'</span>.<span class="built_in">format</span>(<span class="number">1000</span>*dt))</span><br><span class="line"></span><br><span class="line"><span class="comment"># finalize plot</span></span><br><span class="line">ax.set_title(<span class="string">'energy'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'Joule'</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">'second'</span>)</span><br><span class="line">ax.legend(frameon=<span class="literal">True</span>);</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>1000 steps at dt = 10ms<br>3162 steps at dt = 3.2ms<br>10000 steps at dt =  1ms<br>31622 steps at dt = 0.32ms<br>100000 steps at dt = 0.1ms</p>
</blockquote>
<div style="width:60%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/8.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/8.png" class="" title="accuracy"></a></div>

<h3 id="æ—¶é—´æ­¥é•¿å’Œæ•›æ•£æ€§"><a href="#æ—¶é—´æ­¥é•¿å’Œæ•›æ•£æ€§" class="headerlink" title="æ—¶é—´æ­¥é•¿å’Œæ•›æ•£æ€§"></a><strong>æ—¶é—´æ­¥é•¿å’Œæ•›æ•£æ€§</strong></h3><p>å½“æˆ‘ä»¬å¢åŠ æ—¶é—´æ­¥é•¿æ—¶, æ¨¡æ‹Ÿä¼šè¿…é€Ÿå‘æ•£:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">SIM_DURATION = <span class="number">10</span> <span class="comment"># (seconds)</span></span><br><span class="line">TIMESTEPS = np.power(<span class="number">10</span>, np.linspace(-<span class="number">2</span>, -<span class="number">1.5</span>, <span class="number">7</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># get plotting axes</span></span><br><span class="line">ax = plt.gca()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dt <span class="keyword">in</span> TIMESTEPS:</span><br><span class="line">  <span class="comment"># set timestep</span></span><br><span class="line">  model.opt.timestep = dt</span><br><span class="line"></span><br><span class="line">  <span class="comment"># allocate</span></span><br><span class="line">  n_steps = <span class="built_in">int</span>(SIM_DURATION / model.opt.timestep)</span><br><span class="line">  sim_time = np.zeros(n_steps)</span><br><span class="line">  energy = np.zeros(n_steps) * np.nan</span><br><span class="line">  speed = np.zeros(n_steps) * np.nan</span><br><span class="line"></span><br><span class="line">  <span class="comment"># initialize</span></span><br><span class="line">  mujoco.mj_resetData(model, data)</span><br><span class="line">  data.qvel[<span class="number">0</span>] = <span class="number">11</span> <span class="comment"># set root joint velocity</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># simulate</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'simulating {} steps at dt = {:2.2g}ms'</span>.<span class="built_in">format</span>(n_steps, <span class="number">1000</span>*dt))</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_steps):</span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">    <span class="keyword">if</span> data.warning.number.<span class="built_in">any</span>():</span><br><span class="line">      warning_index = np.nonzero(data.warning.number)[<span class="number">0</span>]</span><br><span class="line">      warning = mujoco.mjtWarning(warning_index).name</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f'stopped due to divergence (<span class="subst">{warning}</span>) at timestep <span class="subst">{i}</span>.\n'</span>)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    sim_time[i] = data.time</span><br><span class="line">    energy[i] = <span class="built_in">sum</span>(<span class="built_in">abs</span>(data.qvel))</span><br><span class="line">    speed[i] = np.linalg.norm(data.qvel)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># plot</span></span><br><span class="line">  ax.plot(sim_time, energy, label=<span class="string">'timestep = {:2.2g}ms'</span>.<span class="built_in">format</span>(<span class="number">1000</span>*dt))</span><br><span class="line">  ax.set_yscale(<span class="string">'log'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># finalize plot</span></span><br><span class="line">ax.set_ybound(<span class="number">1</span>, <span class="number">1e3</span>)</span><br><span class="line">ax.set_title(<span class="string">'energy'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'Joule'</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">'second'</span>)</span><br><span class="line">ax.legend(frameon=<span class="literal">True</span>, loc=<span class="string">'lower right'</span>);</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>simulating 1000 steps at dt = 10ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 385.</p>
<p>simulating 825 steps at dt = 12ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 322.</p>
<p>simulating 681 steps at dt = 15ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 166.</p>
<p>simulating 562 steps at dt = 18ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 105.</p>
<p>simulating 464 steps at dt = 22ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 84.</p>
<p>simulating 383 steps at dt = 26ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 61.</p>
<p>simulating 316 steps at dt = 32ms<br>stopped due to divergence (mjWARN_BADQACC) at timestep 45.</p>
</blockquote>
<div style="width:60%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/9.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/9.png" class="" title="divergence"></a></div>

<h2 id="æ¥è§¦åŠ›"><a href="#æ¥è§¦åŠ›" class="headerlink" title="æ¥è§¦åŠ›"></a><strong>æ¥è§¦åŠ›</strong></h2><p>è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ç›’å­å’Œçƒä½“çš„ä¾‹å­, ç»™å®ƒä¸€ä¸ªè‡ªç”±å…³èŠ‚:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">free_body_MJCF = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;asset&gt;</span></span><br><span class="line"><span class="string">    &lt;texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3" </span></span><br><span class="line"><span class="string">    rgb2=".2 .3 .4" width="300" height="300" mark="edge" markrgb=".2 .3 .4"/&gt;</span></span><br><span class="line"><span class="string">    &lt;material name="grid" texture="grid" texrepeat="2 2" texuniform="true"</span></span><br><span class="line"><span class="string">    reflectance=".2"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/asset&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light pos="0 0 1" mode="trackcom"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="ground" type="plane" pos="0 0 -.5" size="2 2 .1" material="grid" solimp=".99 .99 .01" solref=".001 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="box_and_sphere" pos="0 0 0"&gt;</span></span><br><span class="line"><span class="string">      &lt;freejoint/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="red_box" type="box" size=".1 .1 .1" rgba="1 0 0 1" solimp=".99 .99 .01"  solref=".001 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="green_sphere" size=".06" pos=".1 .1 .1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;camera name="fixed" pos="0 -.6 .3" xyaxes="1 0 0 0 1 2"/&gt;</span></span><br><span class="line"><span class="string">      &lt;camera name="track" pos="0 -.6 .3" xyaxes="1 0 0 0 1 2" mode="track"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(free_body_MJCF)</span><br><span class="line">renderer = mujoco.Renderer(model, <span class="number">400</span>, <span class="number">600</span>)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data, <span class="string">"fixed"</span>)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/10.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/10.png" class="" title="contact"></a></div>

<p>è®©æˆ‘ä»¬æ¸²æŸ“è¿™ä¸ª body åœ¨åœ°æ¿ä¸Šæ»šåŠ¨, æ…¢åŠ¨ä½œ, åŒæ—¶å¯è§†åŒ–æ¥è§¦ç‚¹å’ŒåŠ›:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">n_frames = <span class="number">200</span></span><br><span class="line">height = <span class="number">240</span></span><br><span class="line">width = <span class="number">320</span></span><br><span class="line">frames = []</span><br><span class="line">renderer = mujoco.Renderer(model, height, width)</span><br><span class="line"></span><br><span class="line"><span class="comment"># visualize contact frames and forces, make body transparent</span></span><br><span class="line">options = mujoco.MjvOption()</span><br><span class="line">mujoco.mjv_defaultOption(options)</span><br><span class="line">options.flags[mujoco.mjtVisFlag.mjVIS_CONTACTPOINT] = <span class="literal">True</span></span><br><span class="line">options.flags[mujoco.mjtVisFlag.mjVIS_CONTACTFORCE] = <span class="literal">True</span></span><br><span class="line">options.flags[mujoco.mjtVisFlag.mjVIS_TRANSPARENT] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tweak scales of contact visualization elements</span></span><br><span class="line">model.vis.scale.contactwidth = <span class="number">0.1</span></span><br><span class="line">model.vis.scale.contactheight = <span class="number">0.03</span></span><br><span class="line">model.vis.scale.forcewidth = <span class="number">0.05</span></span><br><span class="line">model.vis.<span class="built_in">map</span>.force = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># random initial rotational velocity:</span></span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line">data.qvel[<span class="number">3</span>:<span class="number">6</span>] = <span class="number">5</span>*np.random.randn(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate and render</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_frames):</span><br><span class="line">  <span class="keyword">while</span> data.time &lt; i/<span class="number">120.0</span>: <span class="comment">#1/4x real time</span></span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">  renderer.update_scene(data, <span class="string">"track"</span>, options)</span><br><span class="line">  frame = renderer.render()</span><br><span class="line">  frames.append(frame)</span><br><span class="line"></span><br><span class="line"><span class="comment"># show video</span></span><br><span class="line">media.show_video(frames, fps=<span class="number">30</span>)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="force.mp4" type="video/mp4">
</video>


<h3 id="åˆ†ææ¥è§¦åŠ›"><a href="#åˆ†ææ¥è§¦åŠ›" class="headerlink" title="åˆ†ææ¥è§¦åŠ›"></a><strong>åˆ†ææ¥è§¦åŠ›</strong></h3><p>è®©æˆ‘ä»¬é‡æ–°è¿è¡Œä¸Šè¿°æ¨¡æ‹Ÿ(ä½¿ç”¨ä¸åŒçš„éšæœºåˆå§‹æ¡ä»¶)å¹¶ç»˜åˆ¶ä¸æ¥è§¦ç›¸å…³çš„ä¸€äº›å€¼.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">n_steps = <span class="number">499</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># allocate</span></span><br><span class="line">sim_time = np.zeros(n_steps)</span><br><span class="line">ncon = np.zeros(n_steps)</span><br><span class="line">force = np.zeros((n_steps,<span class="number">3</span>))</span><br><span class="line">velocity = np.zeros((n_steps, model.nv))</span><br><span class="line">penetration = np.zeros(n_steps)</span><br><span class="line">acceleration = np.zeros((n_steps, model.nv))</span><br><span class="line">forcetorque = np.zeros(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># random initial rotational velocity:</span></span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line">data.qvel[<span class="number">3</span>:<span class="number">6</span>] = <span class="number">2</span>*np.random.randn(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate and save data</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_steps):</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  sim_time[i] = data.time</span><br><span class="line">  ncon[i] = data.ncon</span><br><span class="line">  velocity[i] = data.qvel[:]</span><br><span class="line">  acceleration[i] = data.qacc[:]</span><br><span class="line">  <span class="comment"># iterate over active contacts, save force and distance</span></span><br><span class="line">  <span class="keyword">for</span> j,c <span class="keyword">in</span> <span class="built_in">enumerate</span>(data.contact):</span><br><span class="line">    mujoco.mj_contactForce(model, data, j, forcetorque)</span><br><span class="line">    force[i] += forcetorque[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">    penetration[i] = <span class="built_in">min</span>(penetration[i], c.dist)</span><br><span class="line">  <span class="comment"># we could also do</span></span><br><span class="line">  <span class="comment"># force[i] += data.qfrc_constraint[0:3]</span></span><br><span class="line">  <span class="comment"># do you see why?</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plot</span></span><br><span class="line">_, ax = plt.subplots(<span class="number">3</span>, <span class="number">2</span>, sharex=<span class="literal">True</span>, figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">lines = ax[<span class="number">0</span>,<span class="number">0</span>].plot(sim_time, force)</span><br><span class="line">ax[<span class="number">0</span>,<span class="number">0</span>].set_title(<span class="string">'contact force'</span>)</span><br><span class="line">ax[<span class="number">0</span>,<span class="number">0</span>].set_ylabel(<span class="string">'Newton'</span>)</span><br><span class="line">ax[<span class="number">0</span>,<span class="number">0</span>].legend(<span class="built_in">iter</span>(lines), (<span class="string">'normal z'</span>, <span class="string">'friction x'</span>, <span class="string">'friction y'</span>));</span><br><span class="line"></span><br><span class="line">ax[<span class="number">1</span>,<span class="number">0</span>].plot(sim_time, acceleration)</span><br><span class="line">ax[<span class="number">1</span>,<span class="number">0</span>].set_title(<span class="string">'acceleration'</span>)</span><br><span class="line">ax[<span class="number">1</span>,<span class="number">0</span>].set_ylabel(<span class="string">'(meter,radian)/s/s'</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">2</span>,<span class="number">0</span>].plot(sim_time, velocity)</span><br><span class="line">ax[<span class="number">2</span>,<span class="number">0</span>].set_title(<span class="string">'velocity'</span>)</span><br><span class="line">ax[<span class="number">2</span>,<span class="number">0</span>].set_ylabel(<span class="string">'(meter,radian)/s'</span>)</span><br><span class="line">ax[<span class="number">2</span>,<span class="number">0</span>].set_xlabel(<span class="string">'second'</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>,<span class="number">1</span>].plot(sim_time, ncon)</span><br><span class="line">ax[<span class="number">0</span>,<span class="number">1</span>].set_title(<span class="string">'number of contacts'</span>)</span><br><span class="line">ax[<span class="number">0</span>,<span class="number">1</span>].set_yticks(<span class="built_in">range</span>(<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">ax[<span class="number">1</span>,<span class="number">1</span>].plot(sim_time, force[:,<span class="number">0</span>])</span><br><span class="line">ax[<span class="number">1</span>,<span class="number">1</span>].set_yscale(<span class="string">'log'</span>)</span><br><span class="line">ax[<span class="number">1</span>,<span class="number">1</span>].set_title(<span class="string">'normal (z) force - log scale'</span>)</span><br><span class="line">ax[<span class="number">1</span>,<span class="number">1</span>].set_ylabel(<span class="string">'Newton'</span>)</span><br><span class="line">z_gravity = -model.opt.gravity[<span class="number">2</span>]</span><br><span class="line">mg = model.body(<span class="string">"box_and_sphere"</span>).mass[<span class="number">0</span>] * z_gravity</span><br><span class="line">mg_line = ax[<span class="number">1</span>,<span class="number">1</span>].plot(sim_time, np.ones(n_steps)*mg, label=<span class="string">'m*g'</span>, linewidth=<span class="number">1</span>)</span><br><span class="line">ax[<span class="number">1</span>,<span class="number">1</span>].legend()</span><br><span class="line"></span><br><span class="line">ax[<span class="number">2</span>,<span class="number">1</span>].plot(sim_time, <span class="number">1000</span>*penetration)</span><br><span class="line">ax[<span class="number">2</span>,<span class="number">1</span>].set_title(<span class="string">'penetration depth'</span>)</span><br><span class="line">ax[<span class="number">2</span>,<span class="number">1</span>].set_ylabel(<span class="string">'millimeter'</span>)</span><br><span class="line">ax[<span class="number">2</span>,<span class="number">1</span>].set_xlabel(<span class="string">'second'</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:80%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/11.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/11.png" class="" title="analysis"></a></div>

<h3 id="æ‘©æ“¦åŠ›"><a href="#æ‘©æ“¦åŠ›" class="headerlink" title="æ‘©æ“¦åŠ›"></a><strong>æ‘©æ“¦åŠ›</strong></h3><p>è®©æˆ‘ä»¬çœ‹çœ‹æ”¹å˜æ‘©æ“¦å€¼çš„æ•ˆæœ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">MJCF = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;asset&gt;</span></span><br><span class="line"><span class="string">    &lt;texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3"</span></span><br><span class="line"><span class="string">     rgb2=".2 .3 .4" width="300" height="300" mark="none"/&gt;</span></span><br><span class="line"><span class="string">    &lt;material name="grid" texture="grid" texrepeat="6 6"</span></span><br><span class="line"><span class="string">     texuniform="true" reflectance=".2"/&gt;</span></span><br><span class="line"><span class="string">     &lt;material name="wall" rgba='.5 .5 .5 1'/&gt;</span></span><br><span class="line"><span class="string">  &lt;/asset&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;default&gt;</span></span><br><span class="line"><span class="string">    &lt;geom type="box" size=".05 .05 .05" /&gt;</span></span><br><span class="line"><span class="string">    &lt;joint type="free"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/default&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="light" pos="-.2 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="ground" type="plane" size=".5 .5 10" material="grid"</span></span><br><span class="line"><span class="string">     zaxis="-.3 0 1" friction=".1"/&gt; </span></span><br><span class="line"><span class="string">    &lt;camera name="y" pos="-.1 -.6 .3" xyaxes="1 0 0 0 1 2"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body pos="0 0 .1"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;body pos="0 .2 .1"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom friction=".33"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">n_frames = <span class="number">60</span></span><br><span class="line">height = <span class="number">300</span></span><br><span class="line">width = <span class="number">300</span></span><br><span class="line">frames = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># load</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(MJCF)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">renderer = mujoco.Renderer(model, height, width)</span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate and render</span></span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_frames):</span><br><span class="line">  <span class="keyword">while</span> data.time &lt; i/<span class="number">30.0</span>:</span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">  renderer.update_scene(data, <span class="string">"y"</span>)</span><br><span class="line">  frame = renderer.render()</span><br><span class="line">  frames.append(frame)</span><br><span class="line">media.show_video(frames, fps=<span class="number">30</span>)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="friction.mp4" type="video/mp4">
</video>


<h2 id="è‚Œè…±-æ‰§è¡Œå™¨å’Œä¼ æ„Ÿå™¨"><a href="#è‚Œè…±-æ‰§è¡Œå™¨å’Œä¼ æ„Ÿå™¨" class="headerlink" title="è‚Œè…±, æ‰§è¡Œå™¨å’Œä¼ æ„Ÿå™¨"></a><strong>è‚Œè…±, æ‰§è¡Œå™¨å’Œä¼ æ„Ÿå™¨</strong></h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">MJCF = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;asset&gt;</span></span><br><span class="line"><span class="string">    &lt;texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3"</span></span><br><span class="line"><span class="string">     rgb2=".2 .3 .4" width="300" height="300" mark="none"/&gt;</span></span><br><span class="line"><span class="string">    &lt;material name="grid" texture="grid" texrepeat="1 1"</span></span><br><span class="line"><span class="string">     texuniform="true" reflectance=".2"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/asset&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="light" pos="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;geom name="floor" type="plane" pos="0 0 -.5" size="2 2 .1" material="grid"/&gt;</span></span><br><span class="line"><span class="string">    &lt;site name="anchor" pos="0 0 .3" size=".01"/&gt;</span></span><br><span class="line"><span class="string">    &lt;camera name="fixed" pos="0 -1.3 .5" xyaxes="1 0 0 0 1 2"/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;geom name="pole" type="cylinder" fromto=".3 0 -.5 .3 0 -.1" size=".04"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="bat" pos=".3 0 -.1"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint name="swing" type="hinge" damping="1" axis="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="bat" type="capsule" fromto="0 0 .04 0 -.3 .04"</span></span><br><span class="line"><span class="string">       size=".04" rgba="0 0 1 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;body name="box_and_sphere" pos="0 0 0"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint name="free" type="free"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="red_box" type="box" size=".1 .1 .1" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="green_sphere"  size=".06" pos=".1 .1 .1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;site name="hook" pos="-.1 -.1 -.1" size=".01"/&gt;</span></span><br><span class="line"><span class="string">      &lt;site name="IMU"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;tendon&gt;</span></span><br><span class="line"><span class="string">    &lt;spatial name="wire" limited="true" range="0 0.35" width="0.003"&gt;</span></span><br><span class="line"><span class="string">      &lt;site site="anchor"/&gt;</span></span><br><span class="line"><span class="string">      &lt;site site="hook"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/spatial&gt;</span></span><br><span class="line"><span class="string">  &lt;/tendon&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;actuator&gt;</span></span><br><span class="line"><span class="string">    &lt;motor name="my_motor" joint="swing" gear="1"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/actuator&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;sensor&gt;</span></span><br><span class="line"><span class="string">    &lt;accelerometer name="accelerometer" site="IMU"/&gt;</span></span><br><span class="line"><span class="string">  &lt;/sensor&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(MJCF)</span><br><span class="line">renderer = mujoco.Renderer(model, <span class="number">480</span>, <span class="number">480</span>)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data, <span class="string">"fixed"</span>)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/12.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/12.png" class="" title="bat"></a></div>

<p>é©±åŠ¨çƒæ£’å’Œè¢«åŠ¨çš„çš®çº³å¡”.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">n_frames = <span class="number">180</span></span><br><span class="line">height = <span class="number">240</span></span><br><span class="line">width = <span class="number">320</span></span><br><span class="line">frames = []</span><br><span class="line">fps = <span class="number">60.0</span></span><br><span class="line">times = []</span><br><span class="line">sensordata = []</span><br><span class="line"></span><br><span class="line">renderer = mujoco.Renderer(model, height, width)</span><br><span class="line"></span><br><span class="line"><span class="comment"># constant actuator signal</span></span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line">data.ctrl = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate and render</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_frames):</span><br><span class="line">  <span class="keyword">while</span> data.time &lt; i/fps:</span><br><span class="line">    mujoco.mj_step(model, data)</span><br><span class="line">    times.append(data.time)</span><br><span class="line">    sensordata.append(data.sensor(<span class="string">'accelerometer'</span>).data.copy())</span><br><span class="line">  renderer.update_scene(data, <span class="string">"fixed"</span>)</span><br><span class="line">  frame = renderer.render()</span><br><span class="line">  frames.append(frame)</span><br><span class="line"></span><br><span class="line">media.show_video(frames, fps=fps)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="bat.mp4" type="video/mp4">
</video>


<p>è®©æˆ‘ä»¬ç»˜åˆ¶åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æµ‹é‡çš„å€¼:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ax = plt.gca()</span><br><span class="line"></span><br><span class="line">ax.plot(np.asarray(times), np.asarray(sensordata), label=<span class="string">'timestep = {:2.2g}ms'</span>.<span class="built_in">format</span>(<span class="number">1000</span>*dt))</span><br><span class="line"></span><br><span class="line"><span class="comment"># finalize plot</span></span><br><span class="line">ax.set_title(<span class="string">'Accelerometer values'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'meter/second^2'</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">'second'</span>)</span><br><span class="line">ax.legend(frameon=<span class="literal">True</span>, loc=<span class="string">'lower right'</span>);</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:60%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/13.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/13.png" class="" title="acceleration"></a></div>

<p>æ³¨æ„ body è¢«çƒæ£’å‡»ä¸­çš„ç¬é—´æ˜¯å¦‚ä½•åœ¨åŠ é€Ÿåº¦æµ‹é‡ä¸­æ¸…æ™°å¯è§çš„.</p>
<h2 id="é«˜çº§æ¸²æŸ“"><a href="#é«˜çº§æ¸²æŸ“" class="headerlink" title="é«˜çº§æ¸²æŸ“"></a><strong>é«˜çº§æ¸²æŸ“</strong></h2><p>ä¸å…³èŠ‚å¯è§†åŒ–ä¸€æ ·, é™„åŠ çš„æ¸²æŸ“é€‰é¡¹ä½œä¸ºå‚æ•°å…¬å¼€ç»™ <code>render</code> æ–¹æ³•.</p>
<p>è®©æˆ‘ä»¬å›åˆ°ç¬¬ä¸€ä¸ªæ¨¡å‹:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xml = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;mujoco&gt;</span></span><br><span class="line"><span class="string">  &lt;worldbody&gt;</span></span><br><span class="line"><span class="string">    &lt;light name="top" pos="0 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;body name="box_and_sphere" euler="0 0 -30"&gt;</span></span><br><span class="line"><span class="string">      &lt;joint name="swing" type="hinge" axis="1 -1 0" pos="-.2 -.2 -.2"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="red_box" type="box" size=".2 .2 .2" rgba="1 0 0 1"/&gt;</span></span><br><span class="line"><span class="string">      &lt;geom name="green_sphere" pos=".2 .2 .2" size=".1" rgba="0 1 0 1"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/worldbody&gt;</span></span><br><span class="line"><span class="string">&lt;/mujoco&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">model = mujoco.MjModel.from_xml_string(xml)</span><br><span class="line">renderer = mujoco.Renderer(model)</span><br><span class="line">data = mujoco.MjData(model)</span><br><span class="line"></span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line">renderer.update_scene(data)</span><br><span class="line">media.show_image(renderer.render())</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/14.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/14.png" class="" title="render"></a></div>

<h3 id="å¯ç”¨é€æ˜åº¦å’Œåæ ‡è½´å¯è§†åŒ–"><a href="#å¯ç”¨é€æ˜åº¦å’Œåæ ‡è½´å¯è§†åŒ–" class="headerlink" title="å¯ç”¨é€æ˜åº¦å’Œåæ ‡è½´å¯è§†åŒ–"></a><strong>å¯ç”¨é€æ˜åº¦å’Œåæ ‡è½´å¯è§†åŒ–</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Enable transparency and frame visualization</span></span><br><span class="line"></span><br><span class="line">scene_option.frame = mujoco.mjtFrame.mjFRAME_GEOM</span><br><span class="line">scene_option.flags[mujoco.mjtVisFlag.mjVIS_TRANSPARENT] = <span class="literal">True</span></span><br><span class="line">renderer.update_scene(data, scene_option=scene_option)</span><br><span class="line">frame = renderer.render()</span><br><span class="line">media.show_image(frame)</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/15.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/15.png" class="" title="transparency"></a></div>

<h3 id="æ·±åº¦æ¸²æŸ“"><a href="#æ·±åº¦æ¸²æŸ“" class="headerlink" title="æ·±åº¦æ¸²æŸ“"></a><strong>æ·±åº¦æ¸²æŸ“</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Depth rendering</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update renderer to render depth</span></span><br><span class="line">renderer.enable_depth_rendering()</span><br><span class="line"></span><br><span class="line"><span class="comment"># reset the scene</span></span><br><span class="line">renderer.update_scene(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># depth is a float array, in meters.</span></span><br><span class="line">depth = renderer.render()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Shift nearest values to the origin.</span></span><br><span class="line">depth -= depth.<span class="built_in">min</span>()</span><br><span class="line"><span class="comment"># Scale by 2 mean distances of near rays.</span></span><br><span class="line">depth /= <span class="number">2</span>*depth[depth &lt;= <span class="number">1</span>].mean()</span><br><span class="line"><span class="comment"># Scale to [0, 255]</span></span><br><span class="line">pixels = <span class="number">255</span>*np.clip(depth, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">media.show_image(pixels.astype(np.uint8))</span><br><span class="line"></span><br><span class="line">renderer.disable_depth_rendering()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/16.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/16.png" class="" title="depth"></a></div>

<h3 id="åˆ†å‰²æ¸²æŸ“"><a href="#åˆ†å‰²æ¸²æŸ“" class="headerlink" title="åˆ†å‰²æ¸²æŸ“"></a><strong>åˆ†å‰²æ¸²æŸ“</strong></h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@title Segmentation rendering</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update renderer to render segmentation</span></span><br><span class="line">renderer.enable_segmentation_rendering()</span><br><span class="line"></span><br><span class="line"><span class="comment"># reset the scene</span></span><br><span class="line">renderer.update_scene(data)</span><br><span class="line"></span><br><span class="line">seg = renderer.render()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the contents of the first channel, which contains object</span></span><br><span class="line"><span class="comment"># IDs. The second channel, seg[:, :, 1], contains object types.</span></span><br><span class="line">geom_ids = seg[:, :, <span class="number">0</span>]</span><br><span class="line"><span class="comment"># Infinity is mapped to -1</span></span><br><span class="line">geom_ids = geom_ids.astype(np.float64) + <span class="number">1</span></span><br><span class="line"><span class="comment"># Scale to [0, 1]</span></span><br><span class="line">geom_ids = geom_ids / geom_ids.<span class="built_in">max</span>()</span><br><span class="line">pixels = <span class="number">255</span>*geom_ids</span><br><span class="line">media.show_image(pixels.astype(np.uint8))</span><br><span class="line"></span><br><span class="line">renderer.disable_segmentation_rendering()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/17.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/17.png" class="" title="segmentation"></a></div>

<h3 id="ç›¸æœºçŸ©é˜µ"><a href="#ç›¸æœºçŸ©é˜µ" class="headerlink" title="ç›¸æœºçŸ©é˜µ"></a><strong>ç›¸æœºçŸ©é˜µ</strong></h3><p>æœ‰å…³ç›¸æœºçŸ©é˜µçš„æè¿°, è¯·å‚é˜…ç»´åŸºç™¾ç§‘ä¸Šå…³äº<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Camera_matrix">ç›¸æœºçŸ©é˜µ</a>çš„æ–‡ç« .</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_camera_matrix</span>(<span class="params">renderer, data</span>):</span><br><span class="line">  <span class="string">"""Returns the 3x4 camera matrix."""</span></span><br><span class="line">  <span class="comment"># If the camera is a 'free' camera, we get its position and orientation</span></span><br><span class="line">  <span class="comment"># from the scene data structure. It is a stereo camera, so we average over</span></span><br><span class="line">  <span class="comment"># the left and right channels. Note: we call `self.update()` in order to</span></span><br><span class="line">  <span class="comment"># ensure that the contents of `scene.camera` are correct.</span></span><br><span class="line">  renderer.update_scene(data)</span><br><span class="line">  pos = np.mean([camera.pos <span class="keyword">for</span> camera <span class="keyword">in</span> renderer.scene.camera], axis=<span class="number">0</span>)</span><br><span class="line">  z = -np.mean([camera.forward <span class="keyword">for</span> camera <span class="keyword">in</span> renderer.scene.camera], axis=<span class="number">0</span>)</span><br><span class="line">  y = np.mean([camera.up <span class="keyword">for</span> camera <span class="keyword">in</span> renderer.scene.camera], axis=<span class="number">0</span>)</span><br><span class="line">  rot = np.vstack((np.cross(y, z), y, z))</span><br><span class="line">  fov = model.vis.global_.fovy</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Translation matrix (4x4).</span></span><br><span class="line">  translation = np.eye(<span class="number">4</span>)</span><br><span class="line">  translation[<span class="number">0</span>:<span class="number">3</span>, <span class="number">3</span>] = -pos</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Rotation matrix (4x4).</span></span><br><span class="line">  rotation = np.eye(<span class="number">4</span>)</span><br><span class="line">  rotation[<span class="number">0</span>:<span class="number">3</span>, <span class="number">0</span>:<span class="number">3</span>] = rot</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Focal transformation matrix (3x4).</span></span><br><span class="line">  focal_scaling = (<span class="number">1.</span>/np.tan(np.deg2rad(fov)/<span class="number">2</span>)) * renderer.height / <span class="number">2.0</span></span><br><span class="line">  focal = np.diag([-focal_scaling, focal_scaling, <span class="number">1.0</span>, <span class="number">0</span>])[<span class="number">0</span>:<span class="number">3</span>, :]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Image matrix (3x3).</span></span><br><span class="line">  image = np.eye(<span class="number">3</span>)</span><br><span class="line">  image[<span class="number">0</span>, <span class="number">2</span>] = (renderer.width - <span class="number">1</span>) / <span class="number">2.0</span></span><br><span class="line">  image[<span class="number">1</span>, <span class="number">2</span>] = (renderer.height - <span class="number">1</span>) / <span class="number">2.0</span></span><br><span class="line">  <span class="keyword">return</span> image @ focal @ rotation @ translation</span><br></pre></td></tr></tbody></table></figure>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ç›¸æœºçŸ©é˜µä»ä¸–ç•Œåæ ‡æŠ•å½±åˆ°ç›¸æœºåæ ‡:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reset the scene</span></span><br><span class="line">renderer.update_scene(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the world coordinates of the box corners</span></span><br><span class="line">box_pos = data.geom_xpos[model.geom(<span class="string">'red_box'</span>).<span class="built_in">id</span>]</span><br><span class="line">box_mat = data.geom_xmat[model.geom(<span class="string">'red_box'</span>).<span class="built_in">id</span>].reshape(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">box_size = model.geom_size[model.geom(<span class="string">'red_box'</span>).<span class="built_in">id</span>]</span><br><span class="line">offsets = np.array([-<span class="number">1</span>, <span class="number">1</span>]) * box_size[:, <span class="literal">None</span>]</span><br><span class="line">xyz_local = np.stack(<span class="built_in">list</span>(itertools.product(*offsets))).T</span><br><span class="line">xyz_global = box_pos[:, <span class="literal">None</span>] + box_mat @ xyz_local</span><br><span class="line"></span><br><span class="line"><span class="comment"># Camera matrices multiply homogenous [x, y, z, 1] vectors.</span></span><br><span class="line">corners_homogeneous = np.ones((<span class="number">4</span>, xyz_global.shape[<span class="number">1</span>]), dtype=<span class="built_in">float</span>)</span><br><span class="line">corners_homogeneous[:<span class="number">3</span>, :] = xyz_global</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the camera matrix.</span></span><br><span class="line">m = compute_camera_matrix(renderer, data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Project world coordinates into pixel space. See:</span></span><br><span class="line"><span class="comment"># https://en.wikipedia.org/wiki/3D_projection#Mathematical_formula</span></span><br><span class="line">xs, ys, s = m @ corners_homogeneous</span><br><span class="line"><span class="comment"># x and y are in the pixel coordinate system.</span></span><br><span class="line">x = xs / s</span><br><span class="line">y = ys / s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Render the camera view and overlay the projected corner coordinates.</span></span><br><span class="line">pixels = renderer.render()</span><br><span class="line">fig, ax = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">ax.imshow(pixels)</span><br><span class="line">ax.plot(x, y, <span class="string">'+'</span>, c=<span class="string">'w'</span>)</span><br><span class="line">ax.set_axis_off()</span><br></pre></td></tr></tbody></table></figure>
<div style="width:50%;margin:auto"><a href="/2023/04/13/mujoco-tutorial/18.png" class="gallery-item" style="box-shadow: none;"> <img src="/2023/04/13/mujoco-tutorial/18.png" class="" title="projection"></a></div>

<h3 id="ä¿®æ”¹åœºæ™¯"><a href="#ä¿®æ”¹åœºæ™¯" class="headerlink" title="ä¿®æ”¹åœºæ™¯"></a><strong>ä¿®æ”¹åœºæ™¯</strong></h3><p>è®©æˆ‘ä»¬åœ¨ <code>mjvScene</code> ä¸­æ·»åŠ ä¸€äº›ä»»æ„çš„å‡ ä½•å›¾å½¢.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_geom_speed</span>(<span class="params">model, data, geom_name</span>):</span><br><span class="line">  <span class="string">"""Returns the speed of a geom."""</span></span><br><span class="line">  geom_vel = np.zeros(<span class="number">6</span>)</span><br><span class="line">  geom_type = mujoco.mjtObj.mjOBJ_GEOM</span><br><span class="line">  geom_id = data.geom(geom_name).<span class="built_in">id</span></span><br><span class="line">  mujoco.mj_objectVelocity(model, data, geom_type, geom_id, geom_vel, <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">return</span> np.linalg.norm(geom_vel)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_visual_capsule</span>(<span class="params">scene, point1, point2, radius, rgba</span>):</span><br><span class="line">  <span class="string">"""Adds one capsule to an mjvScene."""</span></span><br><span class="line">  <span class="keyword">if</span> scene.ngeom &gt;= scene.maxgeom:</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  scene.ngeom += <span class="number">1</span>  <span class="comment"># increment ngeom</span></span><br><span class="line">  <span class="comment"># initialise a new capsule, add it to the scene using mjv_makeConnector</span></span><br><span class="line">  mujoco.mjv_initGeom(scene.geoms[scene.ngeom-<span class="number">1</span>],</span><br><span class="line">                      mujoco.mjtGeom.mjGEOM_CAPSULE, np.zeros(<span class="number">3</span>),</span><br><span class="line">                      np.zeros(<span class="number">3</span>), np.zeros(<span class="number">9</span>), rgba.astype(np.float32))</span><br><span class="line">  mujoco.mjv_makeConnector(scene.geoms[scene.ngeom-<span class="number">1</span>],</span><br><span class="line">                           mujoco.mjtGeom.mjGEOM_CAPSULE, radius,</span><br><span class="line">                           point1[<span class="number">0</span>], point1[<span class="number">1</span>], point1[<span class="number">2</span>],</span><br><span class="line">                           point2[<span class="number">0</span>], point2[<span class="number">1</span>], point2[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"> <span class="comment"># traces of time, position and speed</span></span><br><span class="line">times = []</span><br><span class="line">positions = []</span><br><span class="line">speeds = []</span><br><span class="line">offset = model.jnt_axis[<span class="number">0</span>]/<span class="number">8</span>  <span class="comment"># offset along the joint axis</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify_scene</span>(<span class="params">scn</span>):</span><br><span class="line">  <span class="string">"""Draw position trace, speed modifies width and colors."""</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(positions) &gt; <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(positions)-<span class="number">1</span>):</span><br><span class="line">      rgba=np.array((np.clip(speeds[i]/<span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">                     np.clip(<span class="number">1</span>-speeds[i]/<span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">                     <span class="number">.5</span>, <span class="number">1.</span>))</span><br><span class="line">      radius=<span class="number">.003</span>*(<span class="number">1</span>+speeds[i])</span><br><span class="line">      point1 = positions[i] + offset*times[i]</span><br><span class="line">      point2 = positions[i+<span class="number">1</span>] + offset*times[i+<span class="number">1</span>]</span><br><span class="line">      add_visual_capsule(scn, point1, point2, radius, rgba)</span><br><span class="line"></span><br><span class="line">duration = <span class="number">6</span>    <span class="comment"># (seconds)</span></span><br><span class="line">framerate = <span class="number">30</span>  <span class="comment"># (Hz)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate and display video.</span></span><br><span class="line">frames = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reset state and time.</span></span><br><span class="line">mujoco.mj_resetData(model, data)</span><br><span class="line">mujoco.mj_forward(model, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> data.time &lt; duration:</span><br><span class="line">  <span class="comment"># append data to the traces</span></span><br><span class="line">  positions.append(data.geom_xpos[data.geom(<span class="string">"green_sphere"</span>).<span class="built_in">id</span>].copy())</span><br><span class="line">  times.append(data.time)</span><br><span class="line">  speeds.append(get_geom_speed(model, data, <span class="string">"green_sphere"</span>))</span><br><span class="line">  mujoco.mj_step(model, data)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(frames) &lt; data.time * framerate:</span><br><span class="line">    renderer.update_scene(data)</span><br><span class="line">    modify_scene(renderer.scene)</span><br><span class="line">    pixels = renderer.render()</span><br><span class="line">    frames.append(pixels)</span><br><span class="line">media.show_video(frames, fps=framerate)</span><br></pre></td></tr></tbody></table></figure>
<video controls="">
     <source src="mjvScene.mp4" type="video/mp4">
</video>
</div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-04-13</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« å°‘å¸¥</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/mujoco/'>
                            mujoco
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E6%B1%89%E5%8C%96/'>
                            æ±‰åŒ–
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    <!-- <div class="post-footer-pre-next">
        <span>ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
        <span class="post-footer-pre-next-last-span-right">ä¸Šä¸€ç¯‡ï¼š<a href=""></a></span>
    </div> -->

    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        ä»¥ä¸Š 
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://comment.shawshai.cn',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'ç•™ä¸‹ä½ çš„è¯„è®ºå§ã€‚', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 2021-2024 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>æ‘†è„±å†·æ°” åªå‘ä¸Šèµ°</span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="//cdn.bootcss.com/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>


</html>